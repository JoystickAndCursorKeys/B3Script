(()=>{"use strict";class t{getBlobURL(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAAKACAYAAADKG3dCAAAgAElEQVR4Xu19QZbjuq7kq2FP//b6baFX01t4f3t/2sPbqXQxk6YJRgQISpSNOueeW2WBIAhEACAly3/+9a9//fP13/DPf/7pi/z7zx809F/WWDiQFGBsqFXN2KPOZS2htoHRmf7/178YP5GQ+RYrPj0QnAQgPRcVhCQA6fBKLMr3RWUSQI9BWBa6ggCrABSttw1L8VX0PJcQIGoRKoAcWP8ZsmIuVWdECxTl+zaDRutNAhBoVQFEqDRFVsyl6kwCvMkeICpbqABKAqwDUFRM0YFB9DzZApGsWEE2VWdWgHUEPvUUKIrFKoBIrHfFVsyl6kwCJAGewKkCKAmwDkBRSS1bIAGlSYCHsxjwrT5GZGwQQvsiutr+bIFAdFaQTdWZLRBHdoVouQkmvaWClVGr6kwCJAFyD9BhFtN+rG4hGBuYpJB7AMFLagYVVJs9KNtzM3Op9mcFyAqQFSArAJNbaJncA5CuUrM1o1bVmRUgK0BWgKwATG6hZX4qwNdf4PcBaK1AMGrDZGVExk7VBjVbMzbM2M/o78mo60bzrNpct/OumicJgCL893oSoO8oL4lVIiYBOv73Ot9zkpMEeHMCfC3vH0+Qc8zv90oVYnn8xhSrmY1yrT9KD2PzDjLfj0J4gpJjkgA7AHjWhiTARK9/VhJgghyVuaP0MDZ7ZSL3BUmAJIB5xFxfUDavKkAV+Zagll09nb2ElQRIAoQSgAVomXSFfE9nr7Id5EkCvAkBjmVYQVZajRkdnvZJIQCrnz0lTAJUyDirn/fMwwJ4BrxWRmZPuBDoUKtS5mflWp+UcciOdlxWgDeqAL0qoPTu3vEs6HogPT6r+3UrQaA5kgA3yeYrK0Avi88QgB2LwFln91GVsq7N6h9V0KwAb1YBSrD/399HvP4X8QLjGiDqOBacIxB6szfbGiYBCE95MnPEGBVwxFJcIl47VALULU/ZX4xaIFW/uvisABdXAA+J1CAj+RkbVIC2bRU6BfLoZ8fkKdAG+wYEAATe2euz87Ngs055mPnZOdRWKgmwIQHYY8dZ4PdOfLxzqwCtbWcIYNla60GVpfVXkc8WaKMWyMqSEWDv6Yi4b9DqZQFdxrHyiGS9EytrTC2bBNiQAN5MrBCFAYeiTwV0rwqgY1fVZobgSYAkwBPOEQjZStKTq3V7MnqvFUL2og1+EiAJ8NYEKKSxiJIESAJME8DTKs2Mqe8bzOg5xiYBkgC3I8As6Ovx1NuhIydMXemBnTyQBNgpGmnLtAfQ5rqdIAkw7fJUsNIDKqBVW5IAqsdSfsoDqwGtGpcEUD2W8k8e2A3Q6L5AtkAJ4KEH7g5oNbxZAVSP3Uz+0wCthicJoHrsYvkEdGwAkgCx/pS1JaBll4UOSAKEurP/bp7gKSR16qZQUv4GwkkAEMTM0G+A8sESPo4ACej3BrS6utsTIAGthjzlaw9sR4AEdAL0TA8sJ0AC+sxw5lyqB2QCJKBVF6f8zh748wXo034mlXFEHtsxXkqZKA8sJ0ACOipUqWeFB2QCJKBXhCF1XuUBeQ9wlaE5b3pghQdCCIDevdIavlpeddRu9oz8VV+LqsbqC6dU/yJ51f9In4K3JMCXt9QAqPJqwIo8e+LmJcJq/ey6V/tzpD8JsCEBWGC2AGOJsFo/C/we0dk1KHMkAYC31AykynuDpYwrsghAPfBbYxRZj61JgC8PoIAdTloJOI/+VfZ4MzNbCVr9jO9b/xz/ZsexpFjlT4Zg2QI5CLYqYGcSQAXxqjV7EhBLrCQA6Sk1uKo8Y0YU+K1WyJv9rQ25SiDkgxU+ZciVFWCTCnAmAbzgXQVSBqiIQNZ1ZHMSIAlAYwuBiVZkCEbrZ/TJj0KgRaq/1cRs4Gayo2oPkx1H9ig/1VNvKGfW2IvJaN3MGns6e4Caba3aebz61JiUeZMATQQYcKjOZuTfhQARp0RM5q7DxvjXStxJgCQAKuo/15kKYG3C6Un+Cpa5UEKaAf8xVXcPMMNAZLDqCM8GSbXfY5MyhrHnrhVg1MKswIKV+b1zJQEUJDtldyOAp01he3NmrU43Pg2LmicJEBENoIMNVlQVYB5tUDMmuwZPxfaEQLFnpD8J4PG+OIYN1pkEUKoAm/2LW9j1im4c7kW8upIAXs8J4xRAzJIAZfaefqZiKJtbZb2CG5MAbNZaHQA1aKo9XhIg8PcytLIWj352jGKH6s9sgRTvLpD1Bowlghdkq/R718u6PlJ/tkCs1yfkZgNmAdUL/HYp0fpn14tcHak//EYYMj7y+gEANYsx8jWwkLzyqIXymERUX756A1v0s2Q85FnZAyvltVV/vmI9+jOSGxEmCdDxahLg4RQGqGcR4LDHIkH9breeTBKgCibK6G3gkXxWgMeLBRmyHHLeCpAEMDI1AmgZVgLEyGcF2KcC1G1QjwQo+xfStTgo/84WKFugJw+oG8zVLVASYLDzyU0wztR33wSX8PcyPZP9swL89WC2QJgsCCy9XHRGBbCqQBIgj0HhBvRdKkBLgpqM6Ig0T4HyFOgHL+i0Zsc9QA329ucsEPhRVctNcG6Ct98EKwRgTvmeqsfXgK1+IWaw5325lJtg3Ne/UwvUa4PaCpAEMBiUm2BMFtQuXLkJ7p0GHZ8lAcgClgS4PwGsZgXtA3ITnJvg22+C8z6AsVlle76sAPeuAEmAJMC3B3qEHx1tvsMmeHTDi7kZli1QtkC3boGWEuDLM9IxKNtyKMeZXtk8BsVtzd0rAJPhkcywAqgEUMG6kjBJgCRAe29A/kLMagKsJEwS4HMIgI46P/IrkSq5Uj490HpA/oGMlS1Nhic9cLYHZAKoBiZhVI+l/JkeWE4AdTFJGNVjKT/jge0IoC4mCaN6LOVrD9yeAGo4kzCqx95b/uMIoIYzCaN67F7ySYDgeCVhgh26WF0SYLGDkfokDPLQ2utJgLX+DdeehIl1aRIg1p/baUvCjEOSBNgOstca9GmESQJci7fbz353wiQBbg/Bey1gN8IkAe6Fn4+zdjVhkgAfB6n3XrBKmCTAe+MhVwc8kARIiHy0B5IAHx3+XHwSIDHw0R6QCWBtMtB751kvR+nfTQ+7/rvJqb/jW9bHfsmdlVf99mP318CQ9wIlAdQQvIc8eifPsUr1pbaqvOrJJ5uTAGP3qZVEPYZTgxeVaNR5LfkkwF/PRAVGBZwVmKv0fBoB2gzftjbqS21VeZXIrf7cAwAPqkQq8igheImC9KqAiJBX390ZKa/anwT4+mVJ5c9dCHDYeSU51MwdIa/E0apUWQHepAIkATAdeqRLAnwoAVYQRj29mZFHx6htWK22KwnwBgQYvf57dEiwomVSf8d3Rp4lwWjPkQT4QAJ4CIMbjIfEDKCP8QjUzLErm/2/5/tyRvdGWFR28J52tIuIsifq2BStC9mLxlt2Kq+EP3TUdozmZOxFMuhI1FqTAupogiUB/kbFe9ozAuooa84QoOj1AlqtAIq8AuayDmVMEoCtxaLcHQlwLLFnN8rUZQOsbIQZWQXISpvSI0o93mqbmE12VoAbV4CaAHVrhH41sm2LEGGYXDIDfqYSRNw36B6D5h7g4f47VoDeXWf2TjQDakUmCWB4y9vr5ia471AmezPtigJuJBsB/lEViHx04uVRiKwAayoAAo33ev2L90qr452PGZcEGHjpUysAAxyPTES/7pnXGhMJ/pWb3dr+J5uzAsRWgN0AGgn2nq4kAPDwp1WATyUAuoOrEjH6vL+dv+j/eRSiPT1A/24VInn1dCJanxqAK+WVG0/tCdauBGwTIWvnyg39oTsJcCXSO3N7gOIZc+ay1SPm2jY1cbLrKnp/boTVpwuHEuvfaILZzD07Htm3+3UPmD1jzvRDEkAg1NkEUMGjyitAm9Gttk2KXTOyPbsUWxVZ1s5a58e2QGhz3vaoqjwbjF65L5+xfXK7D6gruMeOyDFJgL/fwVV7uZWVYJRVUMBG4FAAax0ieMC/KwFUP/d8O1MVGX0fuQdAZLTIhzLjlQTYkQRJgK+ooExuZcKoTTnSb4EatTzWOA8JorJclB5EdOY607urMt7qWMb1YvpxewCU/UfOYgJ/JQF2qQIMsHt+7vlu5gRptL8q15IABqq9FaBWx5AhOmt79CmAZZKAog/JLifA1wTf3wmOajlQy8NmYMbRdcZj7WfnjyBA7Ve21WJIg3yDQDXagI+yMGObOndbtZTTN8aeXlWs17/dJhgFF/X0UQS8ggBsQJGPFBAyFYNNGgjMTBI4nQBfRn1XgFngzI5HQUXX2fnZjZSXAPVXE9m50NpWXmcIwM6vEI+tQigOKGmg8dvuAVinF7mdCcC0Qup6I+R3AX8bw9pfCMAj3zJjP64F6lU7tq1CoGu/rljLo0yFdK+4ngSoXozFbiJRINhMHAUIz3yjUt27xmSSXiaKBBjyu3o90raZ1ge1QlG+t/zzcS1QS3TLMcpmzCrDkSBTAY7kI21LAnx525OJUZCU6975VSCsllfW7JVV1zCaJxL8vb2AskY2udU6P3IPoDh1VjYSbLO2WACbaUeTAE1UvJnYG9yz5/PYuQIkHjt6BJgB/6Gv9f+MXfVYtvefnU96Pfr//M///Z7vv/7r/9DzljH0AFGwZ8vIzvIubPGXkqBVq/TWE58xB1yoU6B9B3m0/1WzXr4UjxR4F9B/+Tqajb/ec+QIKLU9UUFYobP1gNf/vCfXSPZ8c4a/Rqt5epXLlyD1Q9neAJxNAGRnzx4vESJ1WQFD/vPavgbuz1pHQL+SBDIBrCAwzkcBnA1Ea4OHAIcNzFp67Uhrv6pnnKk470TOyc2IpRiAMzJ4Jk3i5d2gTAWYIcBh3ioSjNqf4hZEkNp9LJBG62F1oLCpPouaF9nFXFeArcgycyOZtyYAQ1QELASk2fEoQDMJA9nOzD0r4wG0Z4zHzu7vA7xTBYggwKgdQuD3tFJtIJk5RsG/igSo9USAnR2P9D8Sy+92t7zKER6DooAwDkc6GON7Mmx7U8uxtrC6W7sYf/TWwtrF+sprB6u/losCb5Sevn9fwf+dsFAFQIFhHY30qI5n+v9ef6/YUebwjFHWo+hX9LKxUXSOKlbUfCtaop9z/8bItyEAApEHzB5gqCBAdnts6BF/Vg+qWuq6kT2RJBi9wn2aAGzfGx1otUXZkQDRPrFAFQ3ORz/9O9sK/ZFzuAnABoh1AKsPZYce6ZBuDwFmxqA1IHvRePU6GyOkd2WfjqoMm2xHe4D2dwyGFYANEutcVh8Kgpr9i75jHGvDzBwj+9n5kQ+819lYrQSjansE6awqkAToRMMCCQPeEcCY8So4PPIeEpzR8qC1zNogHYOqwWKcqupke1pWL1MB0DrQXDPkQQCIvI7WWc81C7xIu2dsuZwA7cbG4xj1+LOeAxGABcWIBDP2efwxM4ZZ7wzgZmxj20hmDc9kfr4fYLZAKNO1BrKGqHrRPLP66v2BEjBrXu/eQZk7UpatWGx8I21jSXDIsfbRzwKpwOINmHPRCoCxtreW93zkOTma80jM6NoHEZvOGKvGWrx2wsehVfArWdSr25pjRp8X+CMioDbrDGB452htj/KP1x52nNqmXUqAmX1AZH8dHdwZIrKBPlMu2j+rbS/+Z+0efiXSG0x+cp877kGAxyYL/XC09WwK8ox3HKv3t9Ie20P8p/1BazxCk0B+LNq87dDLJtgL/jPaoEgCPECqBcOSfvZZ/6nDeuzo1jyyaGZsTzcCMAIgGo/Wg66j+UcdBRPfSwjgaYPY0wrs0Ne7wYyj+uB5/vTRQ9+HACx4RyBkdaC4WNcRAVDCRrH9SAL0CIgc1QZoVHJHJGAIgsASrQPN96iW/XJ5JQEQ+Jmu5PYEUKoJaqFYEqBTh90J4AVtjwReXQzpxsRjNTzkrNg+EYBlFJqaAZI610gnq4tpo5DtCPzFNz0SRGTukX4Ul0eyoN6CY6pqSTCrD9lsVx408rU97Y24jACzmbteDBtTlkQxRHndC1xNgCiwnkWCKPCPWqEkQMWkUXZnM/8zMfvZFm3s2NymEioJ8OrZJQQY9VzRmfu3JRjDBrU2PT29xxpYPb1WZdTTsqBv5dj7AlHg/82mv5viaN29OTy4aX3Vi90PAdg2gg0UCxRmXkYX0sPoGDlZHX82AUbkWg3Q1fojwG+1QdsTgAXergRgE4aXMEwbtBqgq/UnAUgUjUjgIVJEC0Sa/iPWggntF5gW6AyARs8RvQEeVgCUPdUgjnbdrz1sTO9+aLHWMQP+0d7A6xdrnAUi5ibUFXdrV50Gjdcy5/UWC98t0JUEiABuD6S1mxgCMKc8jIw3POp9A6b1sdoqr42vm8rnu8NRQEoC/PU0A1ymP0R6FGArsgrQVhEgCpTWWqKrwErw9zqTt6oAvWoSCf5V7ZD66MQO2f8XTK/PCHlJh/c7SkqxZWtM/PnKaHP3xoFNCICRLZBCAO/z41a7xayT6f1HGbVc250AjzhosDoL/G0V2IIACnBRDmCAzcigeaJsZsCsbo6f20INiMy6n/dX9pcqWBKc0faYLdwOFSAKTG12jnr6E4FiZl/wzgRgKsHZmf9lI78LAWoSzLQTSI/np14RAY7rXr3MOf6hv/xu7v/+awwCzm8yuK4CjCoRbz/jfb8MfDv08yIe/1IAWrKjMoZZzkivH4zMzNr6GY1suxztQ8s2tnVh1sa2S6ou23ZNE00Ab998BQHUOVkAvpTPJd8ptgN4FgGY1kWDGX5JgKrvdgRQK8fIIexjy8ycXvAX+6JAieyImocFWnQVYFse1r5TCTDziMHMBpFZZAsMpVIh0LHBiASnYj9rn1cuigRngf9RubTVUi3QDAFqo6KAMmpxWACpjkJujVobmufM60mAv96+CwFYO6PBH90OnQlyNNcsCc7M/mUtSnylCtA+Hsxmvcg2iOn/kZ2KgxBA6uusPxSdu8iqRLgC+EsI0AOcCmhVfnYDPCLAKvC/cxWo44GIcCXwn+3kUgesABEEiNwHMP3/6IssSQAOGO8gxcSaJoB12sKW/YgqwLQ/R+CSAPeHL7ufQytFJJgmQA04b+uCFtHr7VhCthUDOYS1xZJjE8LsPO88HsVI9fFIH/0rkaPzdtagUfvCBJSpAIgYyLmMHSMZ1hez87zreDY+ip/fjgAKGVvSsA72AkwJjHeOcaUd3wnaZZPaW4MaG9XXPf1UBbAmUjP6zD6Ayf69dgxt4iNBqAYkcm50OtPOtRsRVPCzrXe77nYe6lciEQFYY1YTANnZ2xxHgvAKAqjA35UIHgKwuKvXfCkBDkPUqtFugHsgQzp7170O32nzOwv+sparq8FMLDxJ5ykRH5gc9WNoAgS+UQlCulvwsy0OO+eM4+s5Rut4yThBj1A/kon45JfB3iRAxzEssFk5BsxWdvX2/8ycsxhCbdeqihEF/h2qwEwM2CRqtUHdPYDSqyuydQuk9G8MAZAjRkT1BsAL/l/Q+XcgSYCH71DcR93N9/heC6SAWpFl+nm1HWMrECPHEgE5PUqPXRFjWp9W/1WtEOuvnj9QLKYIwCpnwGWWINATI4Kxc7Ny/pz8GDkTTGZuPibPJGHBzbylgrHzOd7jX86c8RnrD7oFQoCDjCI2ecocSJYFNiunBreVnwkmMzcT8Kj3CLGkQXYjUs34jPHHKEbDX4lklSOQqm1Nj61Mvz0jg4LIXp8JJjMHignaGyBQI7AyNr4CLivAi9/YjIzkGPIxMp7AomoYpbPWMz5ytYHGApuVU9aGdM4kDZQQUIzMCqAqRkAdliGjbWKBi+ZG15VgMrIzAR3p94K/6ERAfOxh8C/dMz645R6ABRxkVdA+gLUHARxdVwOK5O9MgGgSMISa8Zc3UZcYmr8SOaOYHYuAia7/ZrZfSLZzsyRCoFavzwTVmsve4/BZmwMkrw/5hZnvQTqk6fU6i7PnavSsp0sAj+J6Eez4ETgV4Ebp6RGK7b9HLZ4eWi3YLMiU7K7otNan6DiDAL05lhDgcAhDgkjgWtWCrSJqFlLXN0MCNJcGND67tydK6ATpN4F470HwXkI+GWX9p6R2VJ82+IpyayJWBwKuSiarBRpvIHnHqxXBk9mUOVSQzsh7CMCOQdVX8YlSjbu/E8yCdzQRqwMRQNVTE4Zpo1YDVK0sxaf8urVsqxJAaZtUWbt1shMS6xeWUC8EUCewSMDq6YGUAW7PRS2ZkJ5Z8Otg5SoN6zsv4JSWqZ3jkWD6x3wecikkUPzCJp6XH8lTJ5mtAmcQwD494QDJSCl+s4in6PjNcHxPPzMGkU0lFePTGRk2uV1OgJqpBQDKxrV2klUBesBiHaQEwQNgRX+/6p1HAIsEdwX/dzX7+u/H/qgAqgCOyoisnhXgf7QGs3DWxs8Azzu2N86rS1stL63E960I0Ov7zsr+n0KA3p6gQFM98eEhzUsq4P+O2deAnxoalcHQ5nO0b6iveexpHWAdi/Iu1SQ9NmszPKQjsq5Xx8zj1p61KmNuSQA2czOOeHcCRJ609LI5k8XfkgDRmWt2HzBjz2huNUMwpJutWsoc3qw9mkPVmQQgIqYSoK4CM+BHet6FAEymJsL0I1JAzeh9KwIc7aTiKKt/Z48wlaPKGbvYsao9qjxrR5Fbrb9nD3t6Nhp7xL+2PervyN7ZZAlfj44CqAZMlUfz5/VrPRAF9FZPIRQ6xUsCTMZfJaQqr5q3Wj/KqOp+pj3xO/49Ww2UNjYJoCKskVcBp8qr5q3Wv5oA6nqRPVkBIjyaOt7KA+p9ptHiP34PoGZcVV5F3mr9KOPOtkDqepE96EHGS1ug3lEnOv70jIlwqqVDBRxa36ytqj2z89X9dquLAVdkNi7zMzoZGcY37gpgAQEBxDuOWcwVMmi9V9j0KXNGkODpWSCm/KFJESBG18sJwiiA9fytve1RWm89lszsfYxjLrRhKzLIB7WuUUXoraU9gWHIMPIpGo/wgMZ7WyClWgz3AF8LMG+EjQKKgo16NwswHvD3gNUGtQfwXvBUAiMA9OxIAoxpgXzajlbla/JMvx7dw0SPwZ4xnuyTY+7pAZS4LNJM/UieB/yeMTPgdzsGvK6R2SAea52dXx3vge+dW6B6vUwLXcfku3MoLRDb0ljOimppRs/vo5aMaWlQ31wcyrRwMz295a9Rz98SCq1FJWlLHmb8THKyyLpCp5V44RdirIB4nIU2PD1QMP1yC8QRGRFoogkQ1a+2AWQfN/BUhHcd0yMWfC3KGSV45HBrfvbz3exH9qAKsAKc79ICMThqkyN8NSIK2IqAtH1dazRTFdhjzbPtR/5MAjy/KJdpw1AMRy0V/H0AFDA0+ez1KwAxa3OO38sDH0WA3Qij2qPKI6ihPQ+7l0B6RvsuZGP0PknR93YVIBpAavAs57MtWbT9CLhJgOYrkdEBOBtAs/O92/gkwHhP4X4Yrncsd3yG9gyrCbZav4cgox60p0+VZ04/2Eyvri/S1hZTUW2VtAfwOuCqEj/bcqjr9cirIFHlrySAxx9nj0kCfHk84jjNGzgV0Kr8lQSItDUrgBdh1bhsgQKcKKhIAvx9mDpbIBs1aF+kHNsJ2EzRvx4Y+T83wYth4s2QKmkWL8NU710f07ZFbIKRfUmAhchBzj8LBAuX+PT7vlH7rBm/1Wtl9CQBFqGDcT6aOkIHmuNdr7O+M78T3Dqm7fHRdfQ8vaVv9H2AXrAseWtPUjuGCb4nq7HOZ+aP1MXMp8qssG9WpzI+CUBEXCGB4nxi6m8Rr85jnGI7a4/aZqh62ySlrEH1FWyB1M0YkkfXrRMR1gnRx6Cr7WXBsYsdrL1RcqvXnQQAkVIzysqsy+pWbZ4B64q5rDaVSYKsj8qa4XuBrIyKnIb2ANZ4tqf/WUDz5XVUAdQ9gLXXQeu/6voKQI7WsmK+UYwYEii+TwIAb9UPkVmkUxy+UnYFGFfay+qe2ROgOfL7AMhDf6+vDAJpwlDsKvCvmLenc5X/kwAC+lYFQTChK7oChKxNK+a2dK7wfxKAjfTGlWAFCEW3nCYeTYIkgCN0uwEu0p76EEH5++HGqA0qWg+6roQ0CaB4q1MFooLuMONnSCQgFNC3BwRRvkDrQdcVXyYBFG8lAcwfwHu7CrD7kZ8Dt64hkdmmGIB0ouvtQlR5lyOaQdG9eIRNHh0vr0a0lESVN4+RV45ZAS6kE12/igAt6HtxuRtOkgAEu1RAjlQyuhiZeg5VnljykwgD/LuS4ZsA7ALvxm410JZ8JMAYXYzMGQRgcYH8vDNuwgigOmtnp6xsMRhwMzIrCaDGEhFg5/3kFAGiHHUHMqignKkm6lyqPNuiscBW5FbE2sIhMxf9hZiaxVHAbx3HGKw4O1I2AmSKjiKLfKLoRP5YFddVcWbtHfkwCYBQ8fd6BNAUHawsK4eWyYIJ6WGvI2IjPaq91nwyAZBhs9drQ2dK26wdvfGzYFPGs7Ks3JVtjzW3hwQq8FH12ZIA7CLLrXiPIxmCHHZYhFTnVIHKyDMyaJ2sr5Ee73XFj1G21nNuRwCvI49xijPZjHgVAQ770D5glgBRgJqJGRu3aFtLXN+KAKwzWfD39HlB5xmHxqDryjpnQTw7HiWvJIDh4civLLZO7gXFCzrPuNEYj77iwmgwzYK/jB+RINrmbStAD9DsJooBMNrcoiriAZ5nTN0CRVaiVm8UeCP0WASIBn9NONeNsJUG1Y605lEyhVpakTwCJiIYo9/yQcR+ZFXsIghgJZ9VNh/+3JoAXqeylYCVa+1QM7oqjwjg1bcKSN44MZV9tc0uAkT3kmpWZB1uAdwL/N66Gdu9gLWqjUffaiCxMWHlil9X2x32OLRqKAMc1lkjOWSXxw4VgKr8igqA/BDh60gdtyNA5OKjdXn2EiypGALNEGC0aWXmjq7W0bFBbdBq4prfCa53ymctevU8xZkKcCI2tUkAPbKnVwDdxD1GHOCaBbS1klp3dCZSbf7PlwH//hrU/psrpwgAACAASURBVJ+NQrT97LxeuSQA6bnZ7Mpk+FXgQSSwQO8hwao1kGGSxZIApMtmT3TaaXr6VoFnRAAW/CwZVq2BDJMslgQQXBZFAvbYVDBtKGoRwAv+Mg5VtSj7V+qxbvpFzvlzI6xWGgWmSENZXV7b0bhV2bNHgFnwvwMJWr+s9P/TKVD0cSEL3Eg5BGam5RklhEhbD111sFeCv9i9CkxRfuklhVU2P1UANAn7/A3a2EU5aqSHJQEjh/wyu57iryjwjyrA7iRgMTbr8zrxTD0KcSjqAWQHEvRsszZWZzq+Dd6KCoBIsJrUXoCeGYcy1xQBRo5kFnMGUVCwkQ1ovDfYZdwVFcBKXLNrmRmP4hBpcz3X6QRg2o4ZR/bGzuxtziLAYfeZbVAkoGbjxYA/qn1r57oFAQ4QKk6yAlLArOg6iwBngz8KUGeCf9bmXtxPJ0CdeRQgzjraO/4sAlxRAWYB5fVp2/6perwxMQnAlEMLrDtvglXHKu1ThO5Dx1V7gNZ+L6i8fphNfqq91nwh9wFqY2YX5nXoqnGqo1U7rjgFQi2iugZVPhIjKD5oro96HFoNFFMZPTrrMW2AovYCXrsQoLx6Z9ue2Xmt8S8EWDXRnfWuAsVu4F+9J0DZ+AqMJAEIr59FgMOU2QpALIcWiVr3jsD/qUhff/k6ZMw/Iw9EAaGdwwKGlwSrouhd/87ATwIIaPECAE3BAIQlA5or4jrjB2ZNEbZE6cgWiPQkE3xS1beYApTZr0MqdrGyV9zRZ21T5L4JwGYZr5xikCp72OT5c3y/9vhTxqN/q3MUfWVcO0+rb9aOdr5af/twHPq3stba/7UNUZ/X/mv19/5tfUPO+vzP14V/el+2jsw6s8QZBSwJ8IBIJAFYMhbcFJCuIsAsfiwSfVfiu1cAJVspGX8EqNGcVqaPqgCWXVYiYLImW6V6647K9CM96hrqhN6Cv02mp1QAFaQr5ZXs5rHjnQjA+iorwFcfPmqjPEBix6xugVg7UBaNqgCWPZEtkLJmtQK0exNEntLeoX0LatlvtQdQNj5KsGpZtOndtQU6gwBs5rc2+u2eRCUJaocQ2FHbU4/PPcDfUySLECrB3qkF8q49kgBtBUAb4tbmtnK05Mg9ACDAbIuFWiPrOsrCvUD3AKtuIGvwIht6bQlqaTwnRQj0VnvDfH77CjALUCbIaiZsM+Dx73fdA3h6epUkCom3rAAqg9kNTw0sFaS5B3jcCCw+7GVm1UdMr9/bh7Vx7O0tPPeqPqICqMBnM/5Zm+Aoe6xKqGRPq18e+ZgBvaftYTeylpyVRNvPcw9w8SZ4NwKoewA1o6uEaVss5rgdbXxrnbkHuBkBmEyP+mDUYipVdRbQaD9QCBnVRl9SAVTjR72pVU6VoM1kOXYe64wcfc5WhNaOyBthrA2eZ4HUTbPS+1s9v4Wn4/PbVwAWkLUT7kwAa71MZUCZ/4w9gEqAOlbWhr23z8k9gIEUJbup5KpPM1Cm9xJyNQHU5DC7wUUtkKcCWBvj3ue3rwCr7wOoJLDO+9nPWYKubIHUNbdk7mXtnk6WPKOnO0ftTa9itPKnnAKpewClVCcBHiG9ag/gaWmYrN8jDMJRO8baE9Sf374CqNmKzbB5H0D17O/d7pUVgO3t2cpwSgXQXbluRBIg7g5wD4wou9eRZVqgXhuDMru0B/hS9vOl2t6xVu+ct207vNkyAuatfWxL1N7mR7agNarEsvYEyI7V12tQz66pN370yEWvhRm1dxE+fHkrxAhQFmhGn7OAtALbknIEAFW2ZBcFVNbpTpv5FPCwPlJJq6zLalvaOVkMWOPaPYOVWNgk21Yhdc3fLVAdvCTAswtZ0KFjzxEhdiOAQt46iSCyjMA+qgy9TG8B39ojWHsCSACFUT3WssHdtQKwGR+Vb4YAKBsyWVWJVw2KUgFU8Pd0MKSwxvV6fmsfYLVH7R5h9G9IgN4ewHLyFQRAvbkHEG2ZHvWhESBCvSwCZeQaP24P8E4tUA8IvY29AhjUi45Iz7YECODsdWVdNamtFmMkY/kF2Wq1IigJqBWD9YWrAqDFW3sK1qhaTtnYMgQY2dDr9z17AASCVddV/55N0FELp2xme31+3cIVzDD/TwJUqBkRoM1ANclHLRMCO9MvIx1s9mT6de9c7DjLb1ZlaH3L7JOm9gBtFuntAT6pAqCAIWIgYOxIgLMqg4U1BuS9aqdUkTI+tAKoJfgK+Za8bbtVA9JqqXoZv5VlQbSCANYaV9jUJgiG8GXNo6NPCxvWfsV7GLKcACPA1c5j5CynzO4TrCCWvhKRoie3AmyszlkCIBDPXu9l/uj7AL19QjvH8e8t7gTPAlgZ780UqNVh+utetl9RAVBlHQFYBffMukf+6N1/USsG2gsc84dWgN7egMnsCoCttoSZp87UCCRWYFFp9rQEKuiQPFobIoBaaRR5BcRoc4+uIz9QBGCUjLIjA8yzCcDYVMhibfiZNSvAmGmj2PW0sUTHkoxNHsLXvkMb3lY/ap8UvFIE6J0CKVmQCc4MATwtDWNTWy3QGKWHRRnce10N/tkEHYFd8V9pnXr62N6/+OotWiClLVLIZjm4nm8k4wVYL8uNsrEK/JF+lXxWq2jpmcnoLbjrddTzod6/vp4EGKCnJguqNCpw2oC1FccKbsl+I3mVED3w9OaZWSNjN+rpmesoTq1vkgAkAazMZe0RFLCg9srqs1WgI3mlDfGuu64YyobYqjSjdgit97j+kQRgHGO1CdbY3rHdqG3pVQBkV9tSIXn1urdlU8huVYJRe9OLhUUeq/1piVfkXggwCrwVALXsqIHZSR6dClmZCoFklzUiO602hB1nVVKrMtR+UfcAFujrz3/eClGylafPGjllRA619KsgWa1ftedd5KsvET4t6Y/y69+bOGNIAGujhvo/xPK6DLJ+UKsMIrKVqVl7PlHOAn7rizsRQSZA3dciEFkli83MrWNZErDgR/YjkLPrYO3uzYfK/oxutL5yvQW+BXBWTo0Pa6dHTiZA7xxd2RuwoLEWgwLuda46Tl0HstsCv1VN6/k9ulmw1KBmMzszRtn0srZ65F4I0G462r3BTAVQQaOSQAVxq58dz8rNVJier0anQCtIUIDcAp/dA1jjPUBdNea0ChAFfpQRZ4GAwI2uW4HyjBtl+TMqQA/AaB9Qk+WtCFBnM3Tm3cpGg78lgQdco4wyOtXqVUA2O3nsvGoPgMA/qgpnkYDxJ5Ixvw/QPgZQK2oBPdoDrAK/d4PsBStypFcvO+5suZYATF/fk1ldBZi9xEiGvg/AlGOrMqwO3mzbM2pbrLuj3jVFEck7PzvOIgDK7sy4yDaRXY8lt3wPcEYFSAJoMGBIiIBsHXmicchSJqMjHcp1mQDqKZBijFc2CaB7DgENAXkVAfSVzI2QCaDeB8gK8BwgJvvOhTRmNCLAMctoo1xapdV7gNnVygTYsQLMnMyw/WgUcEd6UFZmgh2howfuXTfBjE9GMjIB1ApwTL6qCkRvUIujrjgGjTjXj9BRfLDrMehMIuqNpQlQg0O9D7CCBKwNaoZADkbX2YpSy/UShLqvidDR2o5I0FsrOiVS49GTn6ly7ViaAN77ACjQHodY4PCCE2X+1kZ1HkY+IntH6KjX+pGPQvQA27Y9bPbtMXW2HUKZkQGblVWUvYS6DmR3qZKM3ChpzGTHnl6m97cqx/E5eoDOGy9P4uxWrK8P/+ll96g7wSOwqYtgwaE6VZVvKwZaB2s30nPVdfYxZ1auV1Gv8pHcAvWy5GjTiNoVNqiqg1hQs3Ksne8shx6EK2tHWX8nHy1/FgiVa8YZKvg/LUMzPoyUYR+Hjpxzla4XAqyaqNar9pWq/BlryDnGHojei6zy9+kE6GWPUclU5Vc5KvVqHkgCGP5SAV0fxe1+W12DyD7SI7B6gewdd7ZXTq0Ao01Urwowz5qc6bDoc/beaUj5zLvvUf1RgGodWZfTQMWe1X5S1ziSf0sCrKgUK+601oFpAXhGBh3NOWPPKgKs8MnbEcB7Fo2yyjsS4FhzRAVQbgoqlQTFZJRA2LFvR4Bj4VkB2PA/5KL2ACMisMD3ZPmZivNEgH/+6Tsu6o13n7wHYG64zQSS0a/Rwie9ulJaVnmIc+j6JoAF/HaylggewiinQKs2wYyzGBkWIrWuSL1l/hZ0bLZl7VfkaiLuQsrhJvgLxD9538r0NdAPGS9hiiHKja3oY1AmyzIyLChGpyusjpGc1XZcQYIe4HcnwZ9CANTmFNBfRYAaBDPPmjDgZmRY8H4aAXrEW1H1WP8juR8CfPdDR0PU+RNZATwt0MO2P0+92iwJUIaMDNontEDIX+g6Auqq66fuAe6+CZ4JwupWgNUfAcQIHTO+jBz7lqdAK45BR6cP5RqqKpGB8+gqwJ0BcIQOj+2rxrzdfYBVN8J6AbjqyM8Dhhb0HhJE6Ght99hx6PCOa+d/OwIcCzyrAtyJADVoZsAzqgAzej2kjhjzlgSIcAyj424EiMqcHqB7xjAxmJU5lQB1dq4NZ74PUJ8CzZwAzTqsV8LvsgeIXjurL/JYmZ2TlbsNAVjCsAtPuXM9kBWg8rdyJ7itGjtl/3MhlLOt8MDpFSCqD13hjAid7Hl8xFwjHb39yYo5y9Fv/aRAPU/7uSXX2lbk/vv3SZ0V5j8ehluieaB013IY4Ycd+t3WhpVkuDMBDtuTABGob3RcSQJr7lUkaAlgubM8ZsM+SFn0rKoAxe7TCXAlOBZg3VR5xTrRnCtIcEcC1Hfs34YAO7ZVCJCRhGTniibB3Vqg9nEVmgBt6UKPT5fgKg5f9SzNleQ4a1PMzqPEgyHoRxDA882v1nkjx7PA9wCZzYxMsD0yZ8yvzhFJgjsRoIczWAHQpoWtBOX4swURC34P+OoqxLykl7VlBnDsHOx6VVs8lXlky10IYPn9hwC9FgeBvzim/ZaYRYq6TLMlmwWCR66XCRFAPWNa8qM52LV4wR9JAi8B2DVGnAKN/P3zhZgeaBUC1As6xrX6eoC/kgSRbcCxdgbUs4CtfRyla9YPu58Cobh8fyWS+SrkiLEWeerPrf7d09ez2WMkNxt4bysXAdwIHRaZVN96CYBa54g7wQj8x1pPqQAI5Oi6GhRG/ioCzLZD0eCfbYe8LdBqAjDg/yHA8RfvMWdxYPvFeQaEV8t4+nnPmN46PUD2jFF87EkKOxKABf8TAdoeXnHctyLjjRKqnrPlPaDyjJklQdScyL8qCXYjgAJ+kwDISWdd97ZGyjgPsDxjLJ8xuhiZyJgoJNiJACr4KQKgkyA28yugjAwm0uUBl2fMyI6iD92r8AQYrR9VJjTeuwlGest15RjU4x94I6zX40e3PFeSwwNmzxiGAIdMG8TouVjgsVVgFwJ4wE9VANZhXrmrAlzs9czvGYP809O5Yh5kR32dIcEOLZAX/FsQ4DDi0ytAj4w1EGcCrADe0w5dTYBZ39At0Kwjdx3vybKeMez626w7G2B2XrZFa+WuJECEb5IA1S6fdeidCHC8gCDiRQJMOxRBNlaHFSt1vUmAjQhggYwlJgser9wuJIj0RxJgEwLsuAn27Am85GLHRYJ/m00wu/gVcp52xjOG7bF3OQZl7V0RE0tnNPiTAH9PoIrDWQevIsDKG2Hoh+DUfcLZ7RAbmxJLdr3bt0A9R6vOYLMZqzeSAIwuRgZlYhYQSA86smXHq3JsbN6GAEyGUZ2CelpWXwQgD1sUPYpsb50rXhnPxEgFek+ejUs9ll1vSAUojvAYWhvtdejMvB5geca0gfXo8IxpM6La6iAAe2OG9KptaavvVgSIcqJKBE975RkTAf5e66GslwUEC8yIxIXmUtbnJsBXQLvvBlUmn6kAUeBXM8YO8yo+tgDH6lhJgLadQ8BmrrPrsnSx6/1zJQGiQaiQIHpuJmAzLcxsFVF+npYBKNpPeXUc4xhfIv3sei/dA0SDcGcCRILf0w6xGREBC12fjWkE+A8b2fVeRoBZR6FAMI709POzYxi70No87RALCGVuS9Yb20jfsOv9aAK0vSsbACWbK7Je8DFztIAoD42pD4+xNqokYH3Pzs+u9+MJwDrUKzdzQKDMiebpAeLQX358MPp4VNkYR4O/1wLV669JnwRQUCbKMplZVGmKo7msjBg1/8ym+CwC9EieBFiEAATIFdOO5ryCAEwVWAF+qwJsRQDGOV6QrHIqa88V4C+2XTm3uim+Ok7fLeDXf9M/kof6T9UxLNAsuSsduwMAd7ChjU27Kb4yRrVtSYBZtjXjvckg2IyfB+0UoK06EWqrk2JTtF9qfd/rVSoAe7bKGq0elbF6kYOvmpe1P+UeHvAkE6bS1DKXEWAVCAt4RiRYNTciXgJb80AEAY4Z67i0sacJ0D5bMXtuvAqESQANZLtKM5m8Zzu6U//xBLiSeLuCbUe7IgkwWh9VAayv081UgauAeNW8O4JsV5usGDEtphrfJEAwCpggBU/5duo+ggD1Lj86gldsgNHeY8XZ/AqdqK9eTXCUwdH8aHy7PlgBot8mUBugGssSZTcCoHWioJZ1R+lh/Tiaj7WZnStqjchHXQIgkKuLKPLMHkE1GNnCBCZ6zlH2XzWX5Qdm/ciHis0R87HgR1XW01VUP5Q9/UTEk18Z8KsLR4Fjg6EEGM1ZX2/nXzUPson1Q6tnxl7vnJ6OILLCP7VAUZVAAb/HAW3gPM6fCXYPgLuAn8mSkcCPiIUnc1sxV+Pa3QN4ieAF/iijec+DUZb0OJ1tO9QgMLZ6ZFBiWGknmnuWhEsJUIxjibAC+FZ7pDqWAY4XCD1bvLoYO1Mm3gPDU6BPIYDahkX2oPEhTY2KB0wCsOAvk62qAitbIKX1OmSZ6pMVQIHf9bISAQrI2ZcORSzvKgJ4bU8CeD13zTiaAG2Gj3461Fp+EuAaYHzKrNQpkNXenEGCJMCnQPGadUICoN6+JgGSVZc481CUOleUfLZAUZ48R88LAbxfe/SOY1ufVo7ZkJ7jwudZkgBXeN0/J3wYzq86R6YH9vfA0+vRd82q+7tRs/Csx5g1qz5Tuvv7AEmENWDotUfp6zW+ZrWaP5DRU5DB4tyq7APSp5xPV0lJBLjLRnSVs7wb9pE9n0qA3qHJyhNFKwZTBPjEKqFkd4aIo8eoo8hx2Fx01X8/7BtdY+z3yNRvoLN+p2D1W+qK3eEEeLcqEQ34kX9W7hF6QL8a/MUXFtjPIMFyAtyNEKsBb/ljNG9UJfBk6+gxCqgVWa+dpxNgp7bpbLCP1m5l/7ZlqXWopFHly1yRx7YKqFvZet/A3Hhl5LcgwFlVYgfAsxXgyPrFXs+3n9Qv6yhzzFQkLwFGj+f3HsHp7TMO37fzb0mAKELsCHhmD8CAv2xgj//XgByRpnfNkke+85LgCgLUPr8lAVhCoKB5+8SV42ZOgRRAs4RRfLiSBFb704sFqgBvR4CVgEzdaz1wkIapAj0Z9YtYPRK1ZLlFC7Q2JKn9TA+UqjEiAbpW7GUev7fuM/zo+Cp5sW/EOtObOdftPFC3TVaWR8BmKsio7amvZQW4HYTubfCIACqwIzyRBIjwYuqgPdBunFGLQit2CiYBnI7LYT4P9E6Orsj8uQfwxS9HTXrAe3Q6Oa05PCvAKs+m3q4HtiPAl5V5CpRgvcwD9Rnk1y2C0//kl+KdLu8dHpcAjq45p3vLYa2fZghgHeYjnUkAEVqso1k5cfpLxVcDFoH1WHyvYrB3snr6kwACpDyZ3TNGMGm56AhcDGB7BnqTAwv0kVNam5MAJIRmgDwzljQvVAwBzQv8NoO3Ro/0IpsUB9TzJAEIz0UAOEIHYapbhAHYDPCLYd6KwtinLL6sJQkAvBYJ3EhdSrBHsghYEaBnwH/IWHMhG72+OOYzXo77UMkuvhjIytcOYcYc+tnyyOhjAXHoitz49VqAWXuttawCjRdszLizCfCN8a//nu4DeAI+QwBENEZ3IQgiChOEVpfHHyzB0NoZe3sydwT/FRXghQCzu3OUzdT+j5WvQesFTT2uZP47VgCrzaoTycq/z/h/iwpQl2kE6La3Q/IsoJmesZ4LVQCF2HeuAHfN/Jdl/9k9gAKsUalm+ntGxnJkWyHqDN/aVa/pbhXgrgRgYztTXdqxw1Mgpu+2sjSqArUhbM/OykU6KGJ9TH+u+Itd325EmFlj9FpaWy49BWIDeqWc1VN7bIrU5ZmfIaSVKaPm8+iJIkGPiHkfgIhIBHAjdBCmukXU/Zl7IufAWRJYVSgJQAZkBsAzY0nzQsQQyGZamQgD2/1Z2057qlcSQIiMB8ieMYJJS0R3J4K16BFBrDFJABFC7MkXKydOf6r47m1RhDOSAE4vjjL7HbM+k1V7Mle3Rc7w/QxLAsx68EPGv2s1CCPAyrN6T293FS5R/zxrVy/j3sk/s+uPHh9CgNUBiNDPADOinDPzzAQREeDQHbGOGRvvNPbtCaACchY8SiVUbbPAHb3naPXN+mRnQkwTINr5PWd5K0AZ13twzppnNti7EGCmErxrv9/dxH996H4v0FmO8hCgB/7DASOAWmOUDLYTAWZIUHw1WvtsslD8ukp2qgLsSoARkBFAZ0mA9NeBXNkClXkiQMrYGTHPKpAPSWxVAAQEr1OQ3tkWCOlnAMrIWE5VxjI+bOdhNsHMGC/YkM13I4L7K5HIEeyGjXEY2wIh8KMWqICC0bOKAK0/mA0pEwsv4FeNY+LOtGGzZH8iQM+RjKEsQK0FoTkY/atAgGxrA+CtAGUeC/CorVsF1JV6Gd+qcWV01mv6JoAyCSrBKIN5NlVXEuDJWcTLWz0EOHyGYlBkkP+9gK1tWP13xafFn3UCGP1dJsCXMukUCAVghgBM24Tm9wJgZlx7zBqlq1cxrQAjAs3YtHrsCLTqumQCvEMFUJ20KqBMJrfmRoFj9iW7+EH17+UEaDd/SolqsxQbSDQHE0yrb1YDECXvJQDyWR0fVra3JsanUb5g9DBrUW1mdL7sAeoPmFOH3savfIYMYPUzC0cbx14LwQQGyagtD5K32sbe58i/yPbZ6yguV9unrs+8EcaU3F7lQA7w6m0XZoFq9R5B1c/IjwjSXkP+VQGgyI/Af6VdyhpecHTsAWYUqC2QMhfr8B6p2tMYlLkYu0Zg7Oln5XcnAPLdXcF/xHzqUQhPBWCANmrJvo3uHEfWgO8dm6IgMnb1Wq7RPoSV37UFQj67M/B/WvadK4BKsJYENQAjgqXqZ+XbatUjIyPDkJiVYasvq29Xue0rgNpi9VqfCPDXZFT6ctYea2+k7JkiQPYJWb/20y0IUEjAArnXAkWAQ61IHnn2lCxyPT07XzaLxF3wFTat1vnny+HTm+CRkSxoVy809fs9UJ6V+XODYB62KnYmAY5NEJECbhB7P8KbkS2IegRQgRZm3He8bJBb16zPfwgQHeCze1evgxnwP/WMb9oK1GvcnQCPlrhPgt7nI8IkAQa/P2bdS4hOFl7yrhxXg6atAFdm/xFRe/5Atn40AVCV6h09ojErQTnSjQKt2nUHAqhr6sl/LAEYIFtn78zYiOAoOqIJULcZdQWImsfTxyv+YGWfCID64dFdz7ZP3hEkz+UTv0BqdPNpt/VFAbPXYrAEUPvvCHkW6EWunfMjCcCCF919ZfWoQVLl66/0KUeAzDzt1wWR/rZ1QvKMDS0pj3+req2j3I8jAKpyakCK/JUb450I4PXfVeNOJ8AVdzpXgb5t+84KYpuVR/NamXJ0jKisQ83Eiu4zZC8hQPRDar/93Rkus+c4uwqMiDAC5qhiKOQqrYjVXtR9NyvbG7MyqlsSoO692b+vdBKr+2wCHHb1AMtkZXbTrO4BWF/tIncJAZjWoQC/RwDrBtXVTr2SAAfoUSb2+Gc3AnjX+Lab4NGeYkXvz357ywM2dUwvqF6A9OYuVYI9Bi0VqVQgtsqw647QNzwGZQ1h5GaOCFngHmCsZa1vijH2MjJI/9kVYLSRZdogtGaVABHn+hEgR+t66kC+APT9LGR08OYJgB7R/PNtc2+eFS3S6EswM2tVglXLIqCg62je9jy/bGLbLI/0WNdH9s3arti07aMQD1BZJHiA/xGMx//Z798qznnKFM187ZzRCcRrZ9S41QSIsJMhCpK5PQGKI5nTohmnr9Y/Y1v02BY01l4jos3y2q60WyMSbP2FGGsvYGXbXusTmZlX6/eCIXrc7gTw7H2sMVsTwBNYtCn26HzuvX//FUmuWbtWjo88WVptp1qVQr4Uv3pRRT+zuPrcmpF/7CN+9xrsmJVrbnWvtA+duL07ybcmQB14hgSqfAt+Zo4rgL+ClAj47TrflQjbEqB382VUinvgR4Bu53g+9eG+/Dt6ZBo9Tm2RiV2nlxhKm6jInpkcoubangC9hfYCP0MAdo7X1sTeD3iBY4HfOok5LFCIYN036fvg99Mr7nVEgXykJwlgeAeBqtdCjL4xx7QQXpCzm9TRPZMHkfqviLHuuZwB0NVzDAnAOnaVkWpPr8rP7gFGWd5TAXrHjy0RR5l4fHf1ESVEUnT0/G6VYPD7AI+TEZQJV4G/6FVPQFT5lgTqeqP2ACz4UTa2z8iTAN027+vD7vMGV2f/uxAgKgEgAlhEe7059/rCKNT6lDVYLVB9/ZEwnskU5YMr9PxUgDoAO4L/Nwj26czZLVBkwFr/15XIegzjN0k8P8z4rOsVrKM2Z3Q82nsUnNnbRPopStcPib8J3dwIaglwBSHUUx1FvgBEGRPleEuPRYAe+NEjGVcRYHQwYK/79cosqdD+q/jv+/9P6CeirPbIhMquSA+k5VtP1jFo/a2osn+xe+LfPU4vAZy1zrrV632RxMr+IxJ4CfDwmf2y4FEFYCtHHWzPGIQnRML2+scS4DkQz49CjE5TUAC819kWyG576hOe332Acu6P9gIWAUZArv0xOoHq+W300GNtK0Mq68tTWxKgtx8pGf34/2jDjGsGNAAACpxJREFU2DsFQoBuWyH7VSLzXxyyN7PPm9fXNT4fYY6/oDMmwMOHY6qib9vVxKpbipFWlgBl7h4BRhm+1/qgirAlAdrsPGp9WofXrRPbxvRI86r39xNvjzrqTdEpUA3adv7RSZB1YoMI0K6/NydqmSwd7NzWnEjvaFx7bWsC1JtvZiOuypdqUu8X6kpTtxsIEKj1QZkIVTZL/wj8I9IwVcBqM3p6EahZMCtzWmtQEtT2BHg+Dhz//A2TRXsVAxGgdbTi4OdqNq4ivVbNIr6d2dtW6jHnyGYLvMwYdO+gXj/bAvVIYK13Njbf9wFGx4HPC+CekETZkLneC/yoCqjybfb/zfb2HXCrf2fWU1eTMbDsXz55/KyzDeg+gTABFPvrddTEQqdVvetoTJs8WEIq69maAKPjzl4mV+Q9BFAcOyPLtHvP4BiTdsYWNLbdsFrHs4gAJZPXVaL3d2SPev3pTvBoMLuhVA3oyUdmeruFGIFG+6XBiDWrfrAI/JoYVln3q3d8IvX6AJ4F7NG9jVWreHoYrndD6FHmrm19etm+2MVky1YGkeLsNaPgWi3qmXGxbOy1haMqUNomBuwRLSfyLfU4dFGyg8PRgtTrzBGoqjPl7+OBLgGsm0nvRoReZn1Hkt8Hjudb+kIA664oe7f0/CX4Zuyth2mnfLPlqF09kAToRKZXBf7z1ZD+++9eqPy9/v+hplw//q7K7wqQd7crCUAQ4ABzDfAeAQ7wez+3N5joBcGPkdm2+WkK9wA91e/icGUP4MnoI0K0FaP4mb0paYX8XWLjh7Q2Mk+BqucARuBBBKjbH6YFauVngd+GPYnAEWHb16Jw5s9LscegLQHKzHXrUz4rLVPJ8r1/1wSIBn+xY0QC9PDaK6Hmfb2jhuFbIV5fybHHHdIoRyotUNScPT0MAXqxQDZZr1Rhwe15SA7ZpF4fPQSn6uq2818fUm+FeLcjwhHolO8fzAbBA35lv/BYi20lusk/M3bWN8f4cjfYuis8+o4FMz98L9C79pblycmrH/9ABEC9PBpfP0HazYDgKRfUKiECMSAcybTzt88dsdXMmiMJQG6CZwNpjUcA/nQC/Fa7Xw+OvoOgfBvs0PixBHiU1+feAIFtBQlWEwC1QN8gMKrA1dm/9XfPnt6XbEZfvHn5SiTaA7xrC9Tro68gQI+IrM9V8ij9vCK7IjHYFfO5EtRy7YaZ2cTnjbDvDLjmV9ZZYCAgP7L0c5r2jOmBhbVxda/P2qHsF9rq1jtRgo9CmJuHO3gEeLU+2br6lIsBtAKSq6qZYuMKWXQq1JLA/EIMY9ydndwD/NUkYNohFJc7xwStjbnO3Deoj1Tpr0S+WyXYlQDPbUo+DMeA3iNTSCB9Kf6dSFDuA7Rr2qEKeAKaY3wekN8L9C4kGD0DlCTwgemOo7Z7GI55OI2RuWMw0ubzPZAEON/nOeNGHkgCbBSMNOV8D2xHgPYU5N0fyT4/5Dlj7YG3IcDoJUrMy5ueiTf/OwAJs3t4YGsClBtDpQpYR5cPufFDXb2nBEcPgb3Bje57IPBiK9+CAKPb371rqvzFMcrpF3pgewKUKnD837rNrwJalV/o/1R9sQe2JAD7YJj1rLv3hxis583rL7VHxqt9M0Sk7tTFeeASAox6+TrjoyUwX/ZAOtD1/+5/ZRoNo68nCWhXLRE8nQD1d3HtloZ/CAx9a2nWa4UA7WsRD729dwUpnx+ySYDZCM2NP50AJcOP31nz/OMV7bM5z8/xPxygfjWOHZMEmAPY7qPfggDMEefo7QIPUr4eox6fZQu0O4Tn7INfifS0Kb0x6D089TI8m2D0Mz09NzFjVlWAtlWaC2OO9nqA+krkLKBL22MZ6fm+66OFGb/0yeuUelwSIMKL++qgvxJpgbT+fPQcffv929EX0dEpUb2PsI4u1c2x9a6ZbIH2BW+EZV0C1K8GtEA9+kbVbMVoT4os8vw+IsG5wnN/wPptAG7GZ6n61ChbII8H48dMVQAL6KPPe+C2nvisZX9bnscLemsC9ja47EuUikt7FeD4LAkQD7qdNE7tAVQC9EBcPms3wejtBm0F6r0NwPPIQ09P3gneCbKxtkyfAql7gP5pjP7Spx5xHnuD5xnQU52qfKz7U9vVHrjkPsDVi373+Xtt27HmiLvOqBpGzHFmfJIAZ3p78VwtOOvHN+qpPSBFwG+X5pljsXu66pMAV3g9eM4eOHu/WeYFqQr+Ms8dSJAECAbj2eoscDIEYNoiL/jvQoIkwNmIDZxvBE6WAIgESYDAgKWqWA+w2b/MGiWvrmLnVqhzH2DtMaJ67Php8iy4lOyPCGBVgdnsf4c2qHo79Nj1o99e6o1Mec2fLPC9YD7GKaRhNtaWzTNjVT/Myv99OzSnxvMszaGZfTDtU/Vz3n+WUsDsIU17L8FjY026XdugJMAgsmcR0gOu1QTw2HTHMV+vR1/8re87euVEm9GjGkqbgXpuD2lOdMUlUz0RoM147M9NogfRysoU/ceYT5DflQAf0wLVFUAF3Fd3/xfb5WG29t/PpFb1f4L87gSoI8j28bfaBGcLdEnl/Zl0VwKgUyPFayxxFJ1Rsj8tkPWVwNKKvJ7kHNn++THmX6N61z5NfvyG6V7bqAY16saWBdCPuA9QKoDV79v7gOd395Tg/b7RoSXHevnel+QfxLYI+U3vZq9htXH159bfbQi3b6Bo90Uq+FGGzkchOI8+HYNa5bjNVr/V4PH1xPpPDTarh29Ns/R77Wm/Q1wq1SuZ+y/gQvKvrn34oK//+dohF5H9iw1sFWDl2rXNVoGd259H+isJ8u/KR3dwLQCxgPjNxr8j6qzdrzbtaxJ/CWfJ178nULdpUfLP60X21Gt9vino7f8ZkDIVgAWnlwSsfi5Xr5HKRyEMv44SQW/IrHxEePMLMboX82G4xd8hVh/m00P4OiK/Esl70XwtCnorQ5lC/c3e1fKPHvsX1avWwbs4JXf2QBLgb3Q8pNk5sGkb54Hhi7FQ9uy9xJZ57XltWqR8m/3LPOo6kDzn2pS6gwfcBFDe9mwBcwRQVb9njl4bd3yWBLgDdGNsPIUAzOvOey/YGi1x9v2jte7WviRADLjuoKU6Bu3/LNEIaPUbnkdtzeuNqYe09YZoVd7K5KM5RmOyCtwBujE2LiFACyAV0Kr8qP0ZvYYdjYtxcWrZ2QOQAL1syADUyr6905aevue7ub8VowatJdPOMXrFuxWcbIN2hm2cbcM9QJmG7bd7gGx1RBNgpG/UlmX2jwPRnTVN3QcYbR6ta6sIMNpEM9k87wPcGcZ+292nQL1NJALa6vsGHpt6lQCtw+/uHLmbB172AGjTWC9g1Lv3Frpavt0fWL1/a5tq125BTHv8HkgCfPkuCeAH0N1HDgnQOwFCFcAaY53MRMm3rQxbydgTo7sHOu3ve+DvF2Jev66INoW99mI0ZiSPbra1vT06leptiKPGJJDeywMmAdp+etQ3W1UBfT7q0SMIE72G9wp9rua7+/gC2s8zEG2WZG4gKWOsLBz1ea+dUqtSr5VKqLyvB34IwLYhnqx6x0zPniC9LzQ+Y2XDCmBlQ3Z/0LqQ6cMV3e3DeIx+JsMjGz4DGp+xyiRA59UMSYDPAP+xyv8PJwU++OW110gAAAAASUVORK5CYII="}}class e{constructor(t,e,s,i){this.img=t,this.gridw=e,this.gridh=s,this.iconGrid=[];var r=this.img.width,a=this.img.height;this.iconCanvas=document.createElement("canvas"),this.iconContext=this.iconCanvas.getContext("2d"),this.iconCanvas.width=r,this.iconCanvas.height=a,this.iconContext.drawImage(this.img,0,0,r,a),this.xiconcount=r/this.gridw,this.xiconrowcount=a/this.gridh;for(var o=0;o<this.xiconrowcount;o++)for(var n=0;n<this.xiconcount;n++){for(var l,h=n*this.gridw,c=o*this.gridh,d=this.iconContext.getImageData(h,c,this.gridw,this.gridh).data,u=0,g=0,p=4*this.gridw,f=[],m=0;m<this.gridh;m++){u=0;for(var y=[],v=0;v<this.gridw;v++){var A=1;d[(l=g+u)+0]==i.r&&d[l+1]==i.g&&d[l+2]==i.b&&(A=0),y.push(A),u+=4}f.push(y),g+=p}this.iconGrid.push(f)}this.iconCanvas=null,this.iconContext=null,this.img=null}getCharData(t){return this.iconGrid[t]}}class s{constructor(t,e,s,i){this.audioCtx=t,this.waveform=e,this.masterVolume=s,this.volumeFunc=i,this.initialized=!1,this.initializedFully=!1,this.effects=[],this.FLR=10,this.FS=11,this.VLR=20,this.VS=21}enable(){this._init()}disable(){this.maxGain.gain.value=0}_init(){this.initialized||(this.initialized=!0,this.maxGain=this.audioCtx.createGain(),this.maxGain.connect(this.masterVolume),this.maxGain.gain.value=0,this.volumeValue=0,this.gain=this.audioCtx.createGain(),this.gain.connect(this.maxGain),"noise"==this.waveform||(this.filter=null,this.occilator=this.audioCtx.createOscillator(),this.occilator.frequency.value=440,this.frequency=this.occilator.frequency,this.occilator.type=this.waveform,this.occilator.connect(this.gain),this.gain.gain.value=0,this.gain.gain.setValueAtTime(0,this.audioCtx.currentTime),this.occilator.start(0),this.initializedFully=!0))}setVolume(t){this.enable(),this.maxGain.gain.value=t,this.volumeValue=t,0==t&&this.disable()}playBeep(t,e){if(this._init(),this.initializedFully){var s=e/1e3,i=s/20,r=s-s/20,a=s,o=this.audioCtx.currentTime;this.frequency.cancelScheduledValues(o),this.gain.gain.cancelScheduledValues(o),this.frequency.setValueAtTime(t,o),this.gain.gain.linearRampToValueAtTime(1,o+i),this.gain.gain.linearRampToValueAtTime(1,o+r),this.gain.gain.linearRampToValueAtTime(0,o+a)}}clearEffect(){this.effects=[]}addEffect(t,e,s){this.effects.length>254||this.effects.push({type:t,value:e,time:s})}playEffect(t){if(this._init(),this.initializedFully){var e=this.audioCtx.currentTime;this.gain.gain.cancelScheduledValues(e),this.frequency.cancelScheduledValues(e),e+=1e-6;for(var s=0;s<this.effects.length;s++){var i=this.effects[s];i.type==this.VLR?this.gain.gain.linearRampToValueAtTime(i.value,e+i.time/1e3):i.type==this.FLR?this.frequency.linearRampToValueAtTime(i.value+t,e+i.time/1e3):i.type==this.VS?this.gain.gain.setValueAtTime(i.value,e+i.time/1e3):i.type==this.FS&&this.frequency.setValueAtTime(i.value+t,e+i.time/1e3)}}}setAttackDecayRelease(t,e,s){this.attackT=t,this.decayT=e,this.releaseT=s}setSustainLevel(t){this.sustainV=t}playSound(t,e){var s=this.audioCtx.currentTime;if(this._init(),this.initializedFully){var i=this.attackT/1e3,r=this.attackT/1e3+this.decayT/1e3,a=this.attackT/1e3+this.decayT/1e3+e/1e3,o=this.attackT/1e3+this.decayT/1e3+e/1e3+this.releaseT/1e3;this.frequency.cancelScheduledValues(s),this.gain.gain.cancelScheduledValues(s),this.frequency.setValueAtTime(t,s),this.gain.gain.linearRampToValueAtTime(1,s+i),this.gain.gain.linearRampToValueAtTime(this.sustainV,s+r),this.gain.gain.linearRampToValueAtTime(this.sustainV,s+a),this.gain.gain.linearRampToValueAtTime(0,s+o)}}setFrequency(t){var e=this.audioCtx.currentTime;this.frequency.cancelScheduledValues(e),this.frequency.setValueAtTime(t,e)}startSound(t){if(this._init(),this.initializedFully){var e=this.attackT/1e3,s=this.attackT/1e3+this.decayT/1e3;this.frequency.cancelScheduledValues(i),this.frequency.setValueAtTime(t,i);var i=this.audioCtx.currentTime;this.gain.gain.cancelScheduledValues(i),this.gain.gain.linearRampToValueAtTime(1,i+e),this.gain.gain.linearRampToValueAtTime(this.sustainV,i+s)}}releaseSound(t){if(this._init(),this.initializedFully){var e=this.releaseT/1e3;this.frequency.value=t;var s=this.audioCtx.currentTime;this.gain.gain.cancelScheduledValues(s),this.gain.gain.linearRampToValueAtTime(0,s+e)}}}class i{constructor(t){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.masterVolume={value:.8},this.channels=[],this.defaults=["square","sawtooth","triangle","sine","noise","square","sawtooth","triangle"],this.masterGain=this.audioCtx.createGain(),this.masterGain.connect(this.audioCtx.destination),this.masterGain.gain.value=0,this.channelCount=8;for(var e=0;e<this.channelCount;e++)this.channels.push(new t(this.audioCtx,this.defaults[e],this.masterGain,this._int_v2g));this.FLR=10,this.FS=11,this.VLR=20,this.VS=21}_int_log10(t){return Math.log(t)/Math.LN10}_int_v2g(t){var e=-Math.log(1-.9*t)/Math.LN10;return console.log(t,"->",e),e}reset(){for(var t=0;t<this.channelCount;t++)this.channels[t].setVolume(0),this.channels[t].clearEffect()}setVolume(t){this.masterGain.gain.value=this._int_v2g(t)}channelVolume(t,e){this.channels[t].setVolume(e)}channelFrequency(t,e){this.channels[t].setFrequency(e)}channelSetAttackDecayRelease(t,e,s,i){if(t<0||t>7)throw"MrBeep:no such channel "+t;this.channels[t].setAttackDecayRelease(e,s,i)}channelSetSustainLevel(t,e){if(t<0||t>7)throw"MrBeep:no such channel "+t;this.channels[t].setSustainLevel(e)}playBeep(t,e,s){if(t<0||t>7)throw"MrBeep:no such channel "+t;this.channels[t].playBeep(e,s)}playSound(t,e,s){if(t<0||t>7)throw"MrBeep:no such channel "+t;this.channels[t].playSound(e,s)}startSound(t,e){if(t<0||t>7)throw"MrBeep:no such channel "+t;this.channels[t].startSound(e)}releaseSound(t,e){if(t<0||t>7)throw"MrBeep:no such channel "+t;this.channels[t].releaseSound(e)}addEffect(t,e,s,i){this.channels[t].addEffect(e,s,i)}clearEffect(t){this.channels[t].clearEffect()}playEffect(t,e){this.channels[t].playEffect(e)}}class r{constructor(t){if(!t)throw"sys expected";this.sys=t,this.files=[],this.data={},this.prefix=""}init(){}ready(){return!0}exists(t){throw this.makeError("Exists error","Not yet implemented")}saveFile(t,e,s,i){throw this.makeError("saveFile error","Not supported")}makeError(t,e){return{success:!1,reason:t,message:e,fsErrorSignature:!0}}makeDataContainer(t){return{success:!0,data:t}}loadTextFromURL(t,e){var s=new XMLHttpRequest,i=this;s.onreadystatechange=function(){4===s.readyState&&200===s.status?i.loadedFile(t,e,i.makeDataContainer(s.responseText)):4===s.readyState&&200!=s.status&&i.loadedFile(t,e,i.makeError("File not found ("+s.status+")",s.status))},s.overrideMimeType("text/plain"),s.open("GET",this.prefix+t,!0),s.send(null)}loadFile(t,e){this.loadTextFromURL(t,e)}loadedFile(t,e,s){e.clazz[e.method](t,e,s)}getDir(){throw this.makeError("getDir error","Not supported")}deleteFile(t){throw this.makeError("deleteFile error","Not supported")}formatDisk(){throw this.makeError("formatDisk error","Sorry dave, but I cannot allow you to format the internet :)")}}class a{constructor(){this.options={};var t=[];t.push({opt:"file",display:"File"}),t.push({opt:"copy",display:"Copy"}),t.push({opt:"basic",display:"Basic"}),t.push({opt:"screeneditor",display:"Screen"}),t.push({opt:"help",display:"Help"}),this.options.main=t,(t=[]).push({opt:"@requestClipboardCopy",display:"Copy program"}),navigator.clipboard.readText?t.push({opt:"pasteFromClip",data:"pgm",display:"Paste program"}):t.push({opt:"pasteBox",data:"pgm",display:"Paste program"}),t.push({opt:"@requestClipboardCopyScreen",display:"Copy screen data"}),navigator.clipboard.readText?t.push({opt:"pasteFromClip",data:"txt",display:"Paste text"}):t.push({opt:"pasteBox",data:"txt",display:"Paste text"}),this.options.copy=t,(t=[]).push({opt:"@requestRun",display:"Run"}),t.push({opt:"@requestStop",display:"Stop"}),t.push({opt:"@requestList",display:"List Program"}),t.push({opt:"@requestVars",display:"Debug: List Variables"}),t.push({opt:"@requestDataBlocks",display:"Debug: List Data-blocks"}),t.push({opt:"@requestRenumber",display:"Renumber Program"}),t.push({opt:"@requestNew",display:"New Program"}),this.options.basic=t,(t=[]).push({opt:"@requestListDirectory",display:"List directory"}),t.push({opt:"@requestFileSystems",display:"List file systems"}),t.push({opt:"@requestListScripts",display:"List embedded scripts"}),t.push({opt:"@requestExport",display:"Export Basic Program"}),this.options.file=t,(t=[]).push({opt:"@requestResetConsole",display:"Reset Console"}),t.push({opt:"@requestColorReset",data:{fg:1,bg:0,border:10},display:"Dark Mode 1"}),t.push({opt:"@requestColorReset",data:{fg:14,bg:0,border:0},display:"Dark Mode 2"}),t.push({opt:"@requestColorReset",data:{fg:5,bg:0,border:10},display:"Dark Mode 3"}),t.push({opt:"@requestColorReset",data:{fg:0,bg:8,border:0},display:"Light Mode 1"}),t.push({opt:"@requestColorReset",data:{fg:0,bg:8,border:10},display:"Light Mode 2"}),t.push({opt:"@requestColorReset",data:{fg:0,bg:1,border:10},display:"Light Mode 3"}),t.push({opt:"@requestColorReset",data:{fg:15,bg:4,border:15},display:" C64 Theme"}),t.push({opt:"@requestColorReset",data:{fg:14,bg:10,border:14},display:"C128 Theme"}),t.push({opt:"@requestColorReset",data:{fg:4,bg:1,border:6},display:"Vic20 Theme"}),t.push({opt:"@requestColorReset",data:{fg:0,bg:9,border:9},display:"ZX-Spectrum Theme"}),t.push({opt:"@requestColorReset",data:{fg:1,bg:4,border:4},display:"MSX Theme"}),t.push({opt:"@requestColorReset",data:{fg:1,bg:0,border:0},display:"BBC Theme"}),t.push({opt:"@requestColorReset",data:{fg:3,bg:0,border:0},display:"Apple2 Theme"}),this.options.screeneditor=t,(t=[]).push({opt:"@requestHelp",display:"Basic Commands"}),t.push({opt:"@requestAbout",display:"About"}),this.options.help=t}getOptions(){return this.options}}class o{constructor(t){this.menuSys=t,this.sys=this.menuSys.sys}setBasic(){this.basic=this.sys.m.basic}doExposedAction(t,e){"paste"==t&&(navigator.clipboard.readText?this.handler_pasteFromClip(e):this.handler_pasteBox(e))}handler_pasteBox(t){this.menuSys.pastebox.style.display="block",this.menuSys.pasteArea.value=this.menuSys.defaultPasteText,this.oldInnerText=this.menuSys.pasteArea.innerText,this.input=this.sys.input,this.input.unsetInputHandler(),this.menuSys.clearMenu(),this.menuSys.hideMenu(),this.menuSys.pasteArea.style.color=this.menuSys.color,this.menuSys.pasteArea.style.backgroundColor=this.menuSys.bgColor,this.menuSys.pasteArea.focus(),this.menuSys.pasteArea.select(),this.sys.out.hideInner();var e=this;this.pasteHandler=function(t){setTimeout(e.pasteHandler2,10)},this.pasteHandler2=function(s){e.sys.out.showInner(),e.menuSys.unhideMenu(),e.basic.setInput(e.sys.input),e.menuSys.pasteArea.removeEventListener("paste",e.pasteHandler),e.menuSys.pastebox.style.display="none",e.oldInnerText!=e.menuSys.pasteArea.value&&e.basic.pasteTextFromClipboard(e.menuSys.pasteArea.value,t)},this.menuSys.pasteArea.addEventListener("paste",this.pasteHandler)}handler_pasteFromClip(t){var e=this;navigator.clipboard.readText||alert("Clipboard reading is disabled in your browser\nYou have to enable it to make this feature work."),navigator.clipboard.readText().then((s=>{e.basic.pasteTextFromClipboard(s,t)}))}}var n=new class{constructor(){this.fs={},this.fs.default="cache",this.display={},this.display.mode=100,this.warnings={},this.warnings.privacyMute=!0,this.subSys="S3",this.keyboard={},this.keyboard.allowDefault={};var t=this.keyboard.allowDefault;t.all=!1,t.events=[];var e=t.events;e.push("F5"),e.push("F12")}},l=new class{constructor(t,e){var s={};this.m={},s.m=this.m,s.bootCfg=t,this.sys=s,s.init={},s.staticTarget=e,s.headerElement=null,s.domContainer=document.createElement("div"),document.body.appendChild(s.domContainer),s.SIG="BOSS64",s.SUBSYS=s.bootCfg.subSys,s.VERSION="0.2",s.CODENAME="Papa Smurf",s.nulcon=[],s.nulcon.push("Starting System..."),s.nulcon.push("SYS version "+s.VERSION),s.nulcon.push("SYS name "+s.SIG+":"+s.SUBSYS+' "'+s.CODENAME+'"'),s.nulcon.push('SYS release name "'+s.CODENAME+'"'),s.nulcon.push("Starting Boot Sequence...");var i=document.getElementById("boot");this.rootScript=i,this.displayMode=parseInt(i.dataset.mode),isNaN(this.displayMode)&&(this.displayMode=t.display.mode),this.bootMode=i.dataset.boot,this.dynamicMinTarget=!1,this.bootMode&&(this.dynamicMinTarget=this.bootMode.indexOf("min")>=0),s.dynamicMinTarget=this.dynamicMinTarget,this.bootDebug=this.bootMode.indexOf("debug")>=0,this.bootDebug&&s.nulcon.push("Enabled debug mode"),this.dynamicMinTarget&&s.nulcon.push("Enabled minimal target settings for dynamic mode"),document.body.style.backgroundColor="#444444"}getSys(){return this.sys}initSimpleLogging(){var t=this.sys;t.out={buf:""};var e=t.out;t.out.getAll=function(){return e.buf},t.out.writeln=function(t){var s="$"+t+"\n";e.buf+=s,console.log(s)},e.writeln("$Init logging..."),t.rawlog=function(e,s){var i=s,r="";r+=e+": ";for(var a=0;a<i.length;a++){var o=" ";0==a&&(o=""),r+=o+i[a]}t.out.writeln(r)},t.rawlogcon=function(t,e){var s=e,i="";i+=t+": ";for(var r=0;r<s.length;r++){var a=" ";0==r&&(a=""),i+=a+s[r]}console.log(i)},t.log=function(){var e=Array.prototype.slice.call(arguments);t.rawlog("info",e)},t.logwarn=function(){var e=Array.prototype.slice.call(arguments);t.rawlog("warn",e)},t.logerr=function(){var e=Array.prototype.slice.call(arguments);t.rawlog("error",e)},this.logerr=t.logerr,this.logwarn=t.logwarn,this.log=t.log,this.bootDebug||(t.rawlog=t.rawlogcon)}}(n,!0),h=l.getSys();function c(t,e,s){if(s>=5)throw console.log("HALT, probably dependency recursion detected"),"HALT, probably dependency recursion detected";if(console.log(" dependencies for "+t+" checkL="+s),l.dep[t]){console.log("FOUND DEPENDENCY LIST for "+t);for(var i=l.dep[t],r=0;r<i.length;r++)console.log(" add dependency:  "+i[r]),c(i[r],u,s+1)}for(var a=0;a<e.length;a++)if(e[a]==t)return;console.log("ADD MODULE "+t),e.push(t)}l.dep={},l.i={},l.i.displaymodes=class{constructor(t){this.initialized=!1,this.default=100,this.sys=t,this.drivers=[]}init(){this.initialized||(this.drivers.text=this.sys.m.tablecon,this.drivers.canvas=this.sys.m.canvas,this.modes=[],this.modes[0]="text:80x30:font=14",this.modes[1]="text:80x30:font=16",this.modes[2]="text:80x30:font=18",this.modes[3]="text:80x30:font=22",this.modes[4]="text:80x50:font=14",this.modes[5]="text:80x50:font=16",this.modes[6]="text:80x50:font=18",this.modes[7]="text:80x50:font=22",this.modes[8]="text:80x150:font=14",this.modes[9]="text:80x150:font=16",this.modes[10]="text:80x150:font=18",this.modes[11]="text:80x150:font=22",this.modes[100]="canvas:%95",this.modes[101]="canvas:%85",this.modes[102]="canvas:%75",this.modes[103]="canvas:%65",this.modes[104]="canvas:%45",this.modes[105]="canvas:%35",this.modes[106]="canvas:%25",this.modes[107]="canvas:%15",this.modes[110]="canvas:%%95,25",this.modes[111]="canvas:%%95,50",this.modes[120]="canvas:%%25,95",this.modes[121]="canvas:%%50,95",this.modes[200]="canvas:1024x768",this.modes[500]="canvas:800x600",this.modes[501]="canvas:640x512",this.modes[502]="canvas:640x480",this.modes[503]="canvas:640x400",this.modes[504]="canvas:320x512",this.modes[505]="canvas:320x400",this.modes[506]="canvas:320x256",this.modes[507]="canvas:320x200",this.menuCreated=!1)}getDriver(){return this.currentDriver}getMode(t){return this.init(),t?this.modes[t]:getMode(this.default)}getModes(){return this.modes}getCurrentMode(){return this.currentMode}setMode(t,e){this.init(),e&&(this.menu=e),(null==t||-1===t||Number.isNaN(t))&&this.setMode(this.default,e);var s=this.getDeviceConfig(t);if(s){var i=this.currentMode;null==i||-1===i||Number.isNaN(t)||(this.endMode(this.currentMode),this.menuCreated=!1),this.menuCreated||(this.menu.create(),this.menuCreated=!0),s.device.initMode(s.config,this.menu),this.sys.out=s.device,this.sys.out.notifyOnClick(this.sys.m.basicmenu,"onDeselect"),this.currentMode=t,this.currentDriver=s.device}}endMode(){this.init(),this.currentDriver&&(this.currentDriver.destroy(),this.menu.destroy(),this.currentMode=void 0,this.currentDriver=void 0)}getDeviceConfig(t){if(null!=t&&-1!==t&&!Number.isNaN(t)&&this.modes[t]){var e=this.modes[t].split(":");if(!(e.length<2)){var s=e[0];if(this.drivers[s])return{device:this.drivers[s],config:e.splice(1)}}}}},l.i.tablecon=class{constructor(t){this.sys=t,this.cursorOn=!1,this.cols=80,this.rows=30,this.x=0,this.y=0,this.hidden=!1,this.blinking=!0,this.reverse=!1,this.outColors={},this.fontSizeInt=18,this.fontSizeCSS=this.fontSizeInt+"px",this.fontFamily="monospace",this.htmlPalette=["#000000","#ffffff","#ee2222","#22ee22","#2222ee","#eeee22","#22eeee","#ee22ee","#aaaaaa","#777777","#444444","#FFAC1C","#5C3317","#F88379","#79F883","#8379F8"],this.outColors.txtBgColor=this.htmlPalette[0],this.outColors.txtColor=this.htmlPalette[5]}htmlColor(t){return this.htmlPalette[t]}getPlayFields(){return null}destroy(){this.outDiv0.remove(),this.cvs=null,this.cvs2=null,this.ctx=null,this.ctx2=null,this.rowel=void 0,this.cellel=void 0,this.blinkInterval&&(clearInterval(this.blinkInterval),this.blinkInterval=void 0)}init(){}getColumCount(){return this.cols}getRowCount(){return this.rows}getDimensions(){return[this.cols,this.rows]}initMode(t,e){var s=this.sys,i=s.init.queuedMessages;s.init.inputElement=window,this.x=0,this.y=0,this.blinking=!0;var r=t[0].split("x");if(2==r.length&&(this.rows=parseInt(r[1]),this.cols=parseInt(r[0]),2==(r=t[1].split("=")).length)){this.fontSizeInt=parseInt(r[1]),this.fontSizeCSS=this.fontSizeInt+"px",this.colsPercentage=1/this.cols*100,this.outColors.txtBgColor=this.htmlPalette[4],this.outColors.txtColor=this.htmlPalette[1],this.outDiv0=document.createElement("div"),this.outDiv1=document.createElement("div"),this.outEl=document.createElement("table"),this.outEl.value="",this.outDiv0.addEventListener("copy",(t=>{var e=function(){if(document.selection&&document.selection.createRange)return document.selection.createRange().toString();if(window.getSelection){var t=window.getSelection();if(t.rangeCount>0){for(var e=t.getRangeAt(0).cloneContents().childNodes,s="",i=0;i<e.length;i++){""!=s&&(s+="\n");for(var r=e[i].childNodes,a=0;a<r.length;a++)s+=r[a].firstChild.data}return s}return""}return""}();t.clipboardData.setData("text/plain",e),t.preventDefault()})),this.table=this.outEl,this.table.style.borderCollapse="collapse",this.table.style.borderSpacing=0,this.table.style.backgroundColor=this.outColors.txtBgColor,this.table.style.resize="none",this.table.style.fontFamily=this.fontFamily,this.table.style.fontSize=this.fontSizeCSS,this.table.style.tableLayout="fixed",this.table.readOnly=!0,this.table.textAlign="center",this.rowel=[],this.cellel=[];for(var a=0;a<this.rows;a++){var o=document.createElement("tr");o.style.padding="0px",o.style.maxHeight=this.fontSizeInt,o.style.height=this.fontSizeInt,this.rowel.push(o),this.outEl.appendChild(o);for(var n=[],l=0;l<this.cols;l++){var h=document.createElement("td");h.style.padding="0px",h.style.color=this.outColors.txtColor,h.style.backgroundColor=void 0,h.style.textOverflow="",h.style.whiteSpace="nowrap",h.style.overflow="hidden",h.style.maxWidth=this.fontSizeInt,h.style.maxHeight=this.fontSizeInt,h.style.height=this.fontSizeInt,h.innerHTML="&nbsp;",n.push(h),o.appendChild(h)}this.cellel.push(n)}document.body.appendChild(this.outDiv0),this.outDiv0.style.display="table",this.outDiv0.style.width="99%",this.outDiv0.style.height="99%",this.outDiv0.style.position="absolute",this.outDiv0.style.zIndex="10000",this.outDiv1.style.display="table-cell",this.outDiv1.style.verticalAlign="middle",this.table.style.marginLeft="auto",this.table.style.marginRight="auto",this.outDiv0.appendChild(this.outDiv1),e&&(this.headerElementManager=e,this.outDiv1.appendChild(this.headerElementManager.get()),this.headerElementManager.enable()),this.outDiv1.appendChild(this.outEl),e&&this.headerElementManager.setDimensions(this.outEl.clientWidth,480),this.outEl.focus(),this.dirty=!0,this.dirtyFlags={bg:!0,color:!0};var c=this;this.blinkInterval=setInterval((function(){c._int_blink()}),500);for(var d=0;d<i.length;d++)this.writeln(i[d]);this.sys.log("TBCON Ready.")}}native(t){throw"@Operation "+t.action+" not supported on TABLECON"}blinkMode(t){this.blinking=t}notifyOnClick(){}hasPixels(){return!1}_int_updateArea(t,e,s,i,r){for(var a=e;a<=i;a++)for(var o=s;o<=r;o++){var n=this.cellel[o][a],l=t[o-s][a-e];" "==l.txt?n.innerHTML="&nbsp;":n.textContent=l.txt,n.style.color=this.htmlPalette[l.fg],n.style.backgroundColor=this.htmlPalette[l.bg]}}update(t,e){this._int_blinkOff(),this.show(),this.x=t.cx,this.y=t.cy,(this.x<0||this.y<0||this.x>=this.cols||this.y>=this.rows)&&console.log("ouch"),this.outColors.txtBgColor=this.htmlPalette[t.bg],this.outColors.txtColor=this.htmlPalette[t.fg];for(var s=0;s<e.length;s++){var i=e[s];this._int_updateArea(i.cells,i.x1,i.y1,i.x2,i.y2)}}updateAll(t,e){this._int_blinkOff(),this.show(),this.x=t.cx,this.y=t.cy,(this.x<0||this.y<0||this.x>=this.cols||this.y>=this.rows)&&console.log("ouch"),this.outColors.txtBgColor=this.htmlPalette[t.bg],this.outColors.txtColor=this.htmlPalette[t.fg],this._int_updateArea(e,0,0,this.cols-1,this.rows-1)}hide(){this.hidden||(this.outDiv0.hidden=!0,this.hidden=!0)}show(){this.hidden&&(this.outDiv0.hidden=!1,this.hidden=!1)}getElement(){return null}_int_blinkOff(){if(this.cursorOn){this.cursorOn=!1;var t=this.cellel[this.y][this.x];null!=t?(t.style.color=this.outColors.txtColor,t.style.backgroundColor=this.outColors.txtBgColor):console.log("cell at "+this.x+","+this.y+" == null ")}}_int_blink(){if(this.blinking){var t;try{t=this.cellel[this.y][this.x]}catch{t=null}null!=t?(this.cursorOn=!this.cursorOn,this.cursorOn?(t.style.backgroundColor=this.outColors.txtColor,t.style.color=this.outColors.txtBgColor):(t.style.color=this.outColors.txtColor,t.style.backgroundColor=this.outColors.txtBgColor)):console.log("Blink exception: Cell at "+this.x+","+this.y+" == null ")}}clear(){this._int_blinkOff(),this.show();for(var t=0;t<this.cols;t++)for(var e=0;e<this.rows;e++){var s=this.cellel[e][t];s.innerHTML="&nbsp;",s.style.color=this.outColors.txtColor,s.style.backgroundColor=this.outColors.txtBgColor}this.x=0,this.y=0}__int_nl(){this.x=0,this.y++,this.y>=this.rows&&(this.__int_scrollDown(),this.y=this.rows-1)}writeln(t){this._int_blinkOff(),this.show();for(var e=0;e<t.length;e++){var s=t.substr(e,1);this.__int_write_direct_ch(s)}this.__int_nl()}__int_write_direct_ch(t){var e=this.cellel[this.y][this.x];null!=e?(e.innerHTML=" "==t?"&nbsp":t,this.reverse?(e.style.backgroundColor=this.outColors.txtColor,e.style.color=this.outColors.txtBgColor):(e.style.color=this.outColors.txtColor,e.style.backgroundColor=void 0),this.x++,this.x>=this.cols&&(this.x=0,this.__int_nl())):console.log("cell at "+this.x+","+this.y+" == null ")}__int_scrollDown(){for(var t=0;t<this.cols;t++)for(var e=0;e<this.rows-1;e++){var s=this.cellel[e][t],i=this.cellel[e+1][t];s.textContent=i.textContent,s.style.color=i.style.color,s.style.backgroundColor=i.style.backgroundColor}var r=this.rows-1;for(t=0;t<this.cols;t++)(s=this.cellel[r][t]).innerHTML="&nbsp;",this.reverse?(s.style.backgroundColor=this.outColors.txtColor,s.style.color="rgba(0,255,0,0.0)"):(s.style.color=this.outColors.txtColor,s.style.backgroundColor=void 0)}},l.i.canvas=class{constructor(e){this.sys=e,this.cursorOn=!1,this.hidden=!1,this.blinking=!0,this.cursorMode="insert",this.bmFontEnable=!0,this.colors={},this.palette=["#000000","#ffffff","#ee2222","#22aa22","#1111cc","#eeee22","#22eeee","#ee22ee","#bbbbbb","#777777","#444444","#FFAC1C","#5C3317","#F88379","#79F883","#8379F8"];for(var s=function(t){for(var e=t;e.length<2;)e="0"+e;return e},i=this.palette.length,r=0;r<i;r++){var a=this.palette[r],o="#"+(n=s(Math.floor(parseInt(a.substr(1,2),16)/2).toString(16)))+(l=s(Math.floor(parseInt(a.substr(3,2),16)/2).toString(16)))+(h=s(Math.floor(parseInt(a.substr(5,2),16)/2).toString(16)));this.palette.push(o)}for(this.bmPalette=[],r=0;r<this.palette.length;r++){a=this.palette[r];var n=parseInt(a.substr(1,2),16),l=parseInt(a.substr(3,2),16),h=parseInt(a.substr(5,2),16);this.bmPalette.push({r:n,g:l,b:h})}this.defaultTextMode();var c=this,d=new Image;d.onload=function(t){c._postLoadFontImage()},d.src=(new t).getBlobURL(),this.fimage=d,this.GLYPHSADDR=[NaN,NaN,0,128,256,384],this.characterbank0=2,this.characterbank1=3,this.characterbank2=4,this.characterbank3=0,this.bankDefaultBaseAddr=256,this.bankBaseAddr=this.bankDefaultBaseAddr}_postLoadFontImage(){this.bfont=new e(this.fimage,12,20,{r:0,g:0,b:0})}htmlColor(t){return this.palette[t]}getPlayFields(){return null}destroy(){this.outDiv0.remove(),this.cvs=null,this.cvs2=null,this.cvsCursor=null,this.ctx=null,this.ctx2=null,this.ctxCursor=null,this.cache=null,this.cells=[],this.blinkInterval&&(clearInterval(this.blinkInterval),this.blinkInterval=void 0)}defaultTextMode(){this.cols=80,this.rows=30,this.x=0,this.y=0,this.fontSize="20",this.fontSizeCSS=this.fontSize+"px",this.fontSizeIntW=12,this.fontSizeIntH=parseInt(this.fontSize),this.fontFamily="monospace";var t=this.colors;t.bg=0,t.fg=5,this.colors.bgHTML=this.palette[t.bg],this.colors.fgHTML=this.palette[t.fg],this.colors.bgRGB=this.bmPalette[t.bg],this.colors.fgRGB=this.bmPalette[t.fg]}init(){}initMode(t,e){var s,i,r=this.sys,a=r.init.queuedMessages;if(this.cursorOn=!1,this.blinking=!0,t[0].indexOf("x")>0){var o=t[0].split("x");s=parseInt(o[0]),i=parseInt(o[1])}else{var n=window.innerWidth,l=window.innerHeight;if(t[0].startsWith("%%")){var h=t[0].substr(2).split(","),c=h[0]/100,d=h[1]/100;s=Math.floor(n*c),i=Math.floor(l*d)}else if(t[0].startsWith("%")){var u=t[0].substr(1);u/=100,s=Math.floor(n*u),i=Math.floor(l*u)}}this.cols=Math.floor(s/this.fontSizeIntW),this.rows=Math.floor(i/this.fontSizeIntH),s=this.cols*this.fontSizeIntW,i=this.rows*this.fontSizeIntH;var g=this.fontSizeIntW,p=this.fontSizeIntH;this.width=s,this.height=i,console.log("Reinit with ",s,i),console.log(" colsXrows ",this.cols,this.rows),this.x=0,this.y=0,this.blinking=!0;var f=this.colors;f.bg=0,f.fg=5,f.bgHTML=this.palette[f.bg],f.fgHTML=this.palette[f.fg],r.init.inputElement=document.body,this.outDiv0=document.createElement("div"),this.outDiv1=document.createElement("div"),this.center=document.createElement("center"),this.cvs=document.createElement("canvas"),this.ctx=this.cvs.getContext("2d",{alpha:!1}),this.ctx.strokeStyle="#ffffff",this.cX=0,this.cY=0,this.cvs2=document.createElement("canvas"),this.ctx2=this.cvs2.getContext("2d"),this.cvsCursor=document.createElement("canvas"),this.ctxCursor=this.cvsCursor.getContext("2d",{alpha:!1}),this.cache=[],this.updCtxImageData={synched:!1},this.cvs.width=s,this.cvs.height=i,this.cvs2.width=s,this.cvs2.height=i,this.cvsCursor.width=g,this.cvsCursor.height=p,this.offsets=[];var m=this.ctx;m.font=this.fontSizeCSS+" "+this.fontFamily,m.textBaseline="bottom";var y=this.fontSizeIntW/2;for(const t of"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890@+_!#%&/()=?*-:;,.'\""){var v=y-this.ctx.measureText(t).width/2;(o=Math.floor(v))<0&&(o=0),this.offsets[t]=o}this.oIndicatorChar="",this.oIndicatorSize=this.ctx.measureText(this.oIndicatorChar),this.oIndicatorOffset=Math.floor(y-this.oIndicatorSize.width/2),this.cells=[];for(var A=this.colors,C=0;C<this.rows;C++){for(var b=[],x=0;x<this.cols;x++)b.push({txt:" ",fg:A.fg,bg:A.bg});this.cells.push(b)}document.body.appendChild(this.outDiv0),this.outDiv0.style.display="table",this.outDiv0.style.width="99%",this.outDiv0.style.height="99%",this.outDiv0.style.position="absolute",this.outDiv0.style.zIndex="10000",this.outDiv1.style.display="table-cell",this.outDiv1.style.verticalAlign="middle",this.cvs.style.marginLeft="auto",this.cvs.style.marginRight="auto",this.outDiv0.appendChild(this.outDiv1),this.outDiv1.appendChild(this.center),e&&(this.headerElementManager=e,this.center.appendChild(this.headerElementManager.get()),this.headerElementManager.setDimensions(s,i),this.headerElementManager.enable()),this.center.appendChild(this.cvs),this.cvs.focus();var w=this;this.blinkInterval=setInterval((function(){w._int_blink()}),300);for(var k=0;k<a.length;k++)this.writeln(a[k]);this.clear(),this.sys.log("CANVASCON Ready.")}notifyOnClick(t,e){this.cvs.addEventListener("click",(function(){t[e]()}))}hideInner(){this.cvs.hidden=!0}showInner(){this.cvs.hidden=!1}hide(){this.init(),this.hidden||(this.outDiv0.hidden=!0,this.hidden=!0)}show(){this.init(),this.hidden&&(this.outDiv0.hidden=!1,this.hidden=!1)}getElement(){return null}gfilter(t){this.outDiv1.filter=t}blinkMode(t){this.blinking=t}_int_blinkOff(){if(this.cursorOn){var t=this.fontSizeIntW,e=this.fontSizeIntH,s=t*this.x,i=e*this.y;this.ctx,this.ctx.drawImage(this.cvsCursor,s,i),this.cursorOn=!1}}_int_storeset_color(t,e){this.oldfg=t,this.oldbg=e;var s=this.colors;s.fg=t,s.bg=e,s.fgHTML=this.palette[s.fg],s.bgHTML=this.palette[s.bg],s.fgRGB=this.bmPalette[s.fg],s.bgRGB=this.bmPalette[s.bg]}_int_restore_color(){var t=this.colors;t.fg=this.oldfg,t.bg=this.oldbg,t.fgHTML=this.palette[t.fg],t.bgHTML=this.palette[t.bg],t.fgRGB=this.bmPalette[t.fg],t.bgRGB=this.bmPalette[t.bg]}_int_blink(){if(this.blinking){this.cursorOn,this.cursorOn=!this.cursorOn;var t=this.fontSizeIntW,e=this.fontSizeIntH,s=t*this.x,i=e*this.y,r=(this.colors,this.ctx,this.cells[this.y][this.x]);if(this.cursorOn){this.ctxCursor.drawImage(this.cvs,s,i,t,e,0,0,t,e),this.colors.fgHTML;var a=this.colors.fg,o=this.colors.bg;return r.fg==r.bg?0==r.fg?(a=1,o=0):(a=0,o=1):(a=r.fg,o=r.bg),void this.paintCursor(s,i,r.txt,a,o,"overwrite"==this.cursorMode)}this.ctx.drawImage(this.cvsCursor,s,i)}}_int_updateArea(t,e,s,i,r){this.ctx;var a,o,n=this.fontSizeIntW,l=this.fontSizeIntH,h=this.colors;try{for(o=s;o<=r;o++){var c=l*o,d=e*n;for(a=e;a<=i;a++){var u=this.cells[o][a],g=t[o-s][a-e],p=g.txt;h.bg=g.bg,h.fg=g.fg,h.bgHTML=this.palette[g.bg],h.fgHTML=this.palette[g.fg],h.bgRGB=this.bmPalette[g.bg],h.fgRGB=this.bmPalette[g.fg],u.txt=p,u.fg=g.fg,u.bg=g.bg,this._int_paintchar(d,c,p),d+=n}}}catch(t){console.log("x= "+a+" y= "+o),console.log("x0=",e,"y0=",s,"x1=",i,"y1=",r),console.log(t)}}_int_Refresh(){try{for(var t=this.fontSizeIntW,e=this.fontSizeIntH,s=this.colors,i=0,r=s.bg,a=s.fg,o=0;o<=this.rows-1;o++){for(var n=0,l=0;l<=this.cols-1;l++){var h=this.cells[o][l].txt,c=this.cells[o][l].fg,d=this.cells[o][l].bg;s.bg=d,s.fg=c,s.bgHTML=this.palette[d],s.fgHTML=this.palette[c],s.bgRGB=this.bmPalette[d],s.fgRGB=this.bmPalette[c],this._int_paintchar(n,i,h),n+=t}i+=e}s.bg=r,s.fg=a,s.bgHTML=this.palette[s.bg],s.fgHTML=this.palette[s.fg],s.bgRGB=this.bmPalette[s.bg],s.fgRGB=this.bmPalette[s.fg]}catch(t){console.log("x= "+l+" y= "+o),console.log(t)}}paintCursor(t,e,s,i,r,a){this._int_storeset_color(r,i),this._int_paintchar(t,e,s),a&&this._int_drawIndicator(t,e,s),this._int_restore_color()}_int_drawIndicator(t,e,s){var i=this.ctx;i.font=this.fontSizeCSS+" "+this.fontFamily,i.textBaseline="top",i.fillStyle=this.colors.fgHTML,i.fillRect(t,e+4*this.fontSizeIntH/5,this.fontSizeIntW,this.fontSizeIntH/5)}setCharacterBank(t,e){this.characterbank[t]=e}_int_paintchar(t,e,s){this.updCtxImageData.synched=!1;var i=this.colors,r=s+":"+i.bg+":"+i.fg;" "==s&&(r=s+":"+i.bg);var a=this.cache[r],o=this.fontSizeIntW,n=this.fontSizeIntH;if(!a){var l,h,c=document.createElement("canvas"),d=s.charCodeAt(0),u=!1;if(d>=this.bankBaseAddr&&d<this.bankBaseAddr+512&&(d<this.bankBaseAddr+128&&this.characterbank0>=2?(u=!0,h=d-this.bankBaseAddr,l=this.GLYPHSADDR[this.characterbank0]+h):d>=this.bankBaseAddr+128&&d<this.bankBaseAddr+256&&this.characterbank1>=2?(u=!0,h=d-(this.bankBaseAddr+128),l=this.GLYPHSADDR[this.characterbank1]+h):d>=this.bankBaseAddr+256&&d<this.bankBaseAddr+384&&this.characterbank2>=2?(u=!0,h=d-(this.bankBaseAddr+256),l=this.GLYPHSADDR[this.characterbank2]+h):d>=this.bankBaseAddr+384&&this.characterbank3>=2&&(u=!0,h=d-(this.bankBaseAddr+384),l=this.GLYPHSADDR[this.characterbank3]+h)),d>256&&!u){var g=this.ctx.measureText(s),p=Math.floor(g.width);p>o&&(o=p)}c.width=o,c.height=n;var f=c.getContext("2d",{alpha:!1});if(u){for(var m,y=this.bfont.getCharData(l),v=f.getImageData(0,0,o,n),A=v.data,C=0,b=0,x=4*o,w=this.colors.bgRGB,k=this.colors.fgRGB,S=0;S<n;S++){b=0;for(var I=0;I<o;I++)m=b+C,y[S][I]?(A[m+0]=k.r,A[m+1]=k.g,A[m+2]=k.b):(A[m+0]=w.r,A[m+1]=w.g,A[m+2]=w.b),A[m+3]=255,b+=4;C+=x}f.putImageData(v,0,0)}else{f.font=this.fontSizeCSS+" "+this.fontFamily,f.textBaseline="top";var B=0;this.offsets[s]&&(B=this.offsets[s]),f.fillStyle=this.colors.bgHTML,f.fillRect(0,0,o,n),f.fillStyle=this.colors.fgHTML,f.fillText(s,B,0)}this.cache[r]={ctx:f,cvs:c,w:o},a=this.cache[r]}this.ctx.drawImage(a.cvs,t,e)}op_gcolor(t){var e=this.palette[t.c];this.ctx.strokeStyle=e}op_fcolor(t){var e=this.palette[t.c];this.ctx.fillStyle=e}op_line(t){this.updCtxImageData.synched=!1;var e=this.ctx,s=t.x0,i=t.y0;s<0&&(s=this.cX),i<0&&(i=this.cY),e.beginPath(),e.moveTo(s,i),e.lineTo(t.x1,t.y1),e.stroke(),this.cX=t.x1,this.cY=t.y1}op_fillRect(t){this.updCtxImageData.synched=!1;var e=this.ctx,s=t.x,i=t.y,r=t.w,a=t.h;s<0&&(s=0),i<0&&(i=0);var o=-(this.width-(s+r)),n=-(this.height-(i+a));o>0&&(r=this.width-s),n>0&&(a=this.height-a),e.fillRect(s,i,r,a)}native(t){this["op_"+t.action](t.params)}gfxUpdate(t){var e=4*this.width,s=t.pixels,i=this.ctx,r=this.updCtxImageData;r.synched||(r.imd=i.getImageData(0,0,this.width,this.height),r.data=r.imd.data,r.synched=!0);for(var a=r.data,o=r.imd,n=0;n<s.length;n++){var l=s[n],h=l.x,c=l.y*e+4*h,d=this.bmPalette[l.c];a[c+0]=d.r,a[c+1]=d.g,a[c+2]=d.b}i.putImageData(o,0,0)}update(t,e){this._int_blinkOff(),this.show(),this.x=t.cx,this.y=t.cy,(this.x<0||this.y<0||this.x>=this.cols||this.y>=this.rows)&&console.log("ouch"),this.colors.bgHTML=this.palette[t.bg],this.colors.fgHTML=this.palette[t.fg],this.colors.bgRGB=this.bmPalette[t.bg],this.colors.fgRGB=this.bmPalette[t.fg],this.colors.bg=t.bg,this.colors.fg=t.fg,this.cursorMode=t.cursorMode;for(var s=0;s<e.length;s++){var i=e[s];this._int_updateArea(i.cells,i.x1,i.y1,i.x2,i.y2)}}updateAll(t,e){this._int_blinkOff(),this.show(),this.x=t.cx,this.y=t.cy,(this.x<0||this.y<0||this.x>=this.cols||this.y>=this.rows)&&console.log("ouch"),this.colors.bgHTML=this.palette[t.bg],this.colors.fgHTML=this.palette[t.fg],this.colors.bgRGB=this.bmPalette[t.bg],this.colors.fgRGB=this.bmPalette[t.fg],this.colors.bg=t.bg,this.colors.fg=t.fg,this.cursorMode=t.cursorMode,this._int_updateArea(e,0,0,this.cols-1,this.rows-1)}clear(){this._int_blinkOff(),this.show();for(var t=0,e=0;e<this.cols;e++){t=1-t;for(var s=0;s<this.rows;s++)this.cells[s][e].txt=" ",this.cells[s][e].fg=this.colors.fg,this.cells[s][e].bg=this.colors.bg}this.ctx.fillStyle=this.colors.bgHTML,this.ctx.fillRect(0,0,this.cvs.width,this.cvs.height),this.x=0,this.y=0}__int_nl(){this.x=0,this.y++,this.y>=this.rows&&(this.__int_scrollDown(),this.y=this.rows-1)}writeln(t){this.show();for(const e of t)this.__int_write_direct_ch(e);this.__int_nl()}__int_write_direct_ch(t){var e=this.cells[this.y][this.x];if(null!=e){e=t.txt;var s=this.ctx,i=this.fontSizeIntW,r=this.fontSizeIntH,a=0;this.offsets[t.txt]&&(a=this.offsets[t.txt]),this.ctx.fillStyle=this.colors.bgHTML,s.fillRect(i*this.x,r*this.y,i,r),s.fillStyle=this.colors.fgHTML,s.fillText(t.txt,a+i*this.x,r*(this.y+1)),this.x++,this.x>=this.cols&&(this.x=0,this.__int_nl())}else console.log("cell at "+this.x+","+this.y+" == null ")}getDimensions(){return[this.cols,this.rows]}hasPixels(){return!0}getBitmapDimensions(){return[this.width,this.height]}getColumCount(){return this.cols}getRowCount(){return this.rows}__int_scrollDown(){for(var t=0;t<this.cols;t++)for(var e=0;e<this.rows-1;e++)this.cells[e][t],this.cells[e+1][t];var s=this.rows-1;for(t=0;t<this.cols;t++)this.cells[s][t].txt=" ";this.fontSizeIntW;var i=this.fontSizeIntW;this.ctx2.drawImage(this.cvs,0,0);var r=this.cvs2.width,a=this.cvs2.height-i;this.ctx.fillStyle=this.colors.bg,this.ctx.fillRect(0,0,this.cvs.width,this.cvs.height),this.ctx.drawImage(this.cvs2,0,i,r,a-i,0,0,r,a-i)}},l.i.mrbeepaudio=class{constructor(t){this.sys=t}destroy(){}init(){this.mrBeep=new i(s)}reset(){this.mrBeep.reset()}setVolume(t){this.mrBeep.setVolume(t)}channelVolume(t,e){this.mrBeep.channelVolume(t,e)}channelFrequency(t,e){this.mrBeep.channelFrequency(t,e)}channelSetAttackDecayRelease(t,e,s,i){this.mrBeep.channelSetAttackDecayRelease(t,e,s,i)}channelSetSustainLevel(t,e){this.mrBeep.channelSetSustainLevel(t,e)}playBeep(t,e,s){this.mrBeep.playBeep(t,e,s)}playSound(t,e,s){this.mrBeep.playSound(t,e,s)}startSound(t,e){this.mrBeep.startSound(t,e)}releaseSound(t,e){this.mrBeep.releaseSound(t,e)}addEffect(t,e,s,i){this.mrBeep.addEffect(t,e,s,i)}clearEffect(t){this.mrBeep.clearEffect(t)}playEffect(t,e){this.mrBeep.playEffect(t,e)}},l.i.simplewarning=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.key=t.SIG+"__LSConfirmed",this.warningOngoing=!1,console.log("simplewarning initialized"),t.notify=this}init(){}simpleWarning(){if(!this.warningOngoing){this.oldBGColor=document.body.style.backgroundColor,document.body.style.backgroundColor="#ffffff";var t=this;setTimeout((function(){document.body.style.backgroundColor=t.oldBGColor,t.warningOngoing=!1}),200)}}},l.i.priv=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.disable=t.bootCfg.warnings.privacyMute,this.key=t.SIG+"__LSConfirmed",this.verified=!1,this.denied=!1,console.log("PrivWarning initialized")}init(){}confirmLocalStorage(){return!(this.denied||"true"!=localStorage.getItem(this.key)&&!this.disable&&(confirm("!! Do you allow "+this.sys.SIG+" to write to local browser storage !!\nThis is needed to simulate a local harddisk.\n If you do not agree, you can still use the system,\n but you won't be able to save any files, or session information.\n\nAll information will only be stored on the local storage,\n and will not be shared with any server, unless you will give explicit permission.\n\nThank you!")?(localStorage.setItem(this.key,"true"),0):(this.denied=!0,1)))}},l.i.mutedinput=class{constructor(t){}init(){}getKey(){return null}setInputHandler(t,e){}},l.i.domelinput=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.evtQueueKeyPress=[],this.handler=null,this.prefix="",this.cfg=t.bootCfg.keyboard}init(){this.init.inputElement,this.target=window}getKey(){return this.handler||0==this.evtQueueKeyPress.length?null:this.evtQueueKeyPress.shift()}unsetInputHandler(){this.elFun&&(this.target.removeEventListener("keydown",this.elFun),this.elFun=null)}checkIfAllowDefault(t){var e=this.cfg.allowDefault;if(!e)return!0;if(e.all)return!0;for(var s=e.events,i=0;i<s.length;i++)if(s[i]==t.key)return!0;return!1}setInputHandler(t,e){this.handler=t,this.prefix=e,this.elFun&&(this.target.removeEventListener("keydown",this.elFun),this.elFun=null);var s=this.evtQueueKeyPress,i=(this.sys.out,this.handler),r=(e=this.prefix,this),a=function(t){var a={type:"keydown",key:t.key,keyLabel:t.key,shiftKey:t.shiftKey,ctrlKey:t.ctrlKey};t.key.length>1&&(a.key=null,a.keyLabel=t.key,"Enter"==t.key&&(a.key="\n")),r.checkIfAllowDefault(t)||t.preventDefault(),i?i[e+"KeyHandler"](a):s.push(a)};this.elFun=a,this.target.inputMode="text",this.target.addEventListener("keydown",a)}},l.i.htmlwrapper=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.node=document.body,document.body.id="top",this.isAttr=!1}init(){}executeFunction(t){"body.style.backgroundImage"==t[0]&&(document.body.style.backgroundImage="url('"+t[1]+"')",document.body.style.backgroundSize="cover")}execute(t){var e=t[0];console.log("execute",e);var s=e.htmlHandle;if(s?this.setnode(s):this.isAttr=!1,null!=this.node)if(0==this.isAttr)if(e.htmlAppend){var i=document.createElement("span");i.innerHTML=e.htmlValue;const t=i.childNodes;var r=[];for(let e=0;e<t.length;e++)r.push(t[e]);for(let t=0;t<r.length;t++)this.node.appendChild(r[t]);i=null}else{if("top"==this.node.id)return void console.log("Cannot replace body code. it would crash the console!");this.node.innerHTML=e.htmlValue}else{var a=this.node.attributes.getNamedItem(this.attrName);if(null==a)return void console.log("Attr '"+this.attrName+"' not found on html node "+this.node.id+"!");a=a.nodeValue,e.htmlAppend?a+=e.htmlValue:a=e.htmlValue,this.node.setAttribute(this.attrName,a)}else console.log("invalid html root")}setnode(t){if(console.log("setnode",t),this.isAttr=!1,".."==t)this.node=this.node.parentNode;else{var e=t.split("."),s=null,i=null;if(e.length>1?(i=e[0],s=e[1]):i=t,""!=i){var r=document.getElementById(i);if(!r)return void console.log("could not find",t);this.node=r}""!=s&&null!=s&&(this.isAttr=!0,this.attrName=s)}}},l.i.basic=class{constructor(t){this.apps=[],this.sys=t,this.audioInitFlag=!1}audioInit(){if(!this.audioInitFlag){var t=this.sys.audio;this.audio=t,t.channelVolume(0,1),t.setVolume(1),this.audioInitFlag=!0}}init(){var t=this.sys,e=t.out;this.cfg=this.sys.bootCfg,this.settings={},t.m.htmlwrapper,t.m.displaymodes,this.out=e,this.menu=t.m.basicmenu,t.staticTarget?this.worker=new Worker("basicworker.js"):t.dynamicMinTarget?this.worker=new Worker("sys/modules/basic/worker/workerbootstrap_min.js"):this.worker=new Worker("sys/modules/basic/worker/workerbootstrap_max.js"),this.sys.m.qfs.loadFile("cache://settings.cfg",{clazz:this,method:"initMore"})}initMore(t,e,s){var i=this.sys,r=i.out,a=i.audio,o=i.m.htmlwrapper,n=i.m.displaymodes,l=void 0;s.success&&(l=s.data.colors),this.worker.postMessage({type:"inittxtarea",w:r.getColumCount(),h:r.getRowCount()}),this.worker.postMessage({type:"initcolors",colors:l}),this.worker.postMessage({type:"systeminfo",modes:n.getModes(),mode:n.getCurrentMode(),windowWidth:window.innerWidth,windowHeight:window.innerHeight}),this.worker.postMessage({type:"setcfg",cfg:this.cfg});var h=[-1,-1];r.hasPixels()&&(h=r.getBitmapDimensions()),this.worker.postMessage({type:"initbitmap",w:h[0],h:h[1]});var c=this;this.worker.onmessage=function(t){var e=t.data.message,s=t.data.type;if("syslog"==s)i.log("BWSYS:",t.data.message);else if("syserr"==s)i.logerr("BWERR:",t.data.message);else if("write"==s)for(var l=0;l<e.length;l++)r.write(e[l]);else if("writeln"==s)for(l=0;l<e.length;l++)r.writeln(e[l]);else if("writec"==s)r.writec(e);else if("border"==s)document.body.style.backgroundColor=r.htmlColor(e.d);else if("gfilter"==s)r.gfilter(e.d);else if("pfinit"==s){r.pfInit(e.ix,e.bcwC,e.brhC,e.fgColor,e.bgColor);var h=e.isCurrentIx,d=r.getPlayFields(),u=r.getPfBufferDimensions(e.ix),g=[-1,-1];if(h){var p=r.getPfCells(e.ix);this.postMessage({type:"message",processId:e.processId,message:"pfinit:current:done",messageObject:{pfIx:e.ix,textW:u[0],textH:u[1],cells:p,playfields:d}})}else this.postMessage({type:"message",processId:e.processId,message:"pfinit:other:done",messageObject:{pfIx:e.ix,textW:u[0],textH:u[1],playfields:d}})}else if("pfselect"==s)u=r.getPfBufferDimensions(e.ix),p=r.getPfCells(e.ix),r.setPlayfield(e.ix),this.postMessage({type:"message",processId:e.processId,message:"pfselect:done",messageObject:{pfIx:e.ix,textW:u[0],textH:u[1],cells:p}});else if("pfscrollpos"==s)r.scrollPlayfield(e.ix,e.x,e.y);else if("pfenable"==s)r.enablePlayfield(e.ix,e.flag);else if("pfviewsize"==s)r.setView(e.ix,e.x,e.y,e.w,e.h);else if("audio"==s){c.audioInit();var f=e.method,m=e.parCount;1==m?a[f](e.p1):2==m?a[f](e.p1,e.p2):3==m?a[f](e.p1,e.p2,e.p3):4==m?a[f](e.p1,e.p2,e.p3,e.p4):0==m&&a[f]()}else if("blinkMode"==s)r.blinkMode(e.m);else if("signalHideMenu"==s)i.m.basicmenu&&(console.log("signalHideMenu hideFlag=",e.hide),i.m.basicmenu.showMenu(!e.hide));else if("locate"==s)r.setPos(e.c,e.r);else if("load"==s)c.loadAppFromProgram(this,e);else if("loaddata"==s)c.loadDataFromProgram(this,e);else if("save"==s)c.saveProgram(this,e);else if("delete"==s)c.deleteFile(this,e);else if("dir"==s)c.dir(e.path,e);else if("setfs"==s)c.setfs(e.path,e),c.menu.setStatus(null);else if("listfs"==s)c.listfs(e);else if("html"==s)o.execute(e);else if("htmlnode"==s)o.setnode(e[0].value);else if("htmldofun"==s)o.executeFunction(e);else if("displaymode"==s){n.setMode(e.m,c.menu),r=n.getDriver(),i.out=r,u=r.getDimensions();var y=r.hasPixels();d=r.getPlayFields(),g=[-1,-1],y&&(g=r.getBitmapDimensions()),this.postMessage({type:"message",processId:e.processId,message:"displaymode:done",messageObject:{mode:e.m,textW:u[0],textH:u[1],bitmapW:g[0],bitmapH:g[1],pfEnabled:null!=d,playfields:d}})}else if("textupdate"==s){var v={cx:e.cx,cy:e.cy,fg:e.fg,bg:e.bg,cursorMode:e.cursorMode};i.out.update(v,e.areasList)}else if("textupdate-all"==s)v={cx:e.cx,cy:e.cy,fg:e.fg,bg:e.bg,cursorMode:e.cursorMode},i.out.updateAll(v,e.cells);else if("gfxupdate"==s)i.out.gfxUpdate(e);else if("export"==s)if("disk"==e.destination){var A={clazz:c,method:"nullHandler",data:""};i.m.qfs.saveFile("export://myprogram.bas",e.code,A)}else navigator.clipboard.writeText(e.code);else"nativeout"==s?i.out.native(e):"status"==s?c.menu.setStatus(e.status):"synch"==s&&(console.log("got synch request, send synch back"),c.worker.postMessage({type:"synchreply",processId:e.processId}))};var d=this;window.addEventListener("resize",(function(t){d.windowResizeEvent(t)}))}windowResizeEvent(t){var e=window.innerWidth,s=window.innerHeight;this.worker.postMessage({type:"interrupt",sub:"resize",data:{w:e,h:s}})}nullHandler(t){console.log("nullhandler "+t)}loadApp(t){var e=this.sys;e.log("BSYS:","Load",t),e.m.qfs.loadFile(t,{clazz:this,method:"loadedApp"})}pasteTextFromClipboard(t,e){if("txt"==e)for(var s={keyLabel:"",shiftKey:!1,ctrlKey:!1,key:"",type:"keydown"},i=0;i<t.length;i++){var r=t.charAt(i);s.key=r,10==t.charCodeAt(i)?s.keyLabel="Enter":s.keyLabel="",this.worker.postMessage(s)}else this.worker.postMessage({type:"pastpgm",data:t})}requestClipboardCopy(){this.worker.postMessage({type:"clipboardCopy"})}requestClipboardCopyScreen(){this.worker.postMessage({type:"clipboardCopyScreen"})}requestColorReset(t){this.worker.postMessage({type:"colorReset",colors:t});var e={clazz:this,method:"nullHandler",data:""};this.settings.colors=t,this.sys.fs.saveFile("cache://settings.cfg",this.settings,e)}requestExport(){this.worker.postMessage({type:"export"})}requestFileSystems(){for(var t=this.sys.fs.listFS(),e=["FS",""],s=0;s<t.length;s++){var i=t[s];e.push(i)}this.requestShowList(e)}requestListDirectory(){for(var t=this.sys.fs.getDir(this.sys.fs.getCurrent()),e=["DIR",""],s=0;s<t.files.length;s++){var i=t.files[s].fname;e.push(i)}this.requestShowList(e)}requestListScripts(){console.log("I am handler_listScripts",this);for(var t=this.sys.m.script.getDir(),e=[],s=0;s<t.files.length;s++){var i=t.files[s].fname;e.push(i)}this.requestShowList(e)}requestAbout(){this.worker.postMessage({type:"resetConsole"});var t=[];t.push(""),t.push("---------------------------"),t.push("  B3 Basic"),t.push("  Version 0.9"),t.push("  Copyright: "),t.push("    CursorKeys Retro, 2022"),t.push("---------------------------"),t.push(""),this.requestShowList(t)}requestList(){this.worker.postMessage({type:"list"})}requestRenumber(){this.worker.postMessage({type:"renumber"})}requestNew(){this.worker.postMessage({type:"new"})}requestVars(){this.worker.postMessage({type:"vars"})}requestDataBlocks(){this.worker.postMessage({type:"datablocks"})}requestHelp(){this.worker.postMessage({type:"help"})}requestClearScreen(){this.worker.postMessage({type:"clearScreen"})}requestResetConsole(){this.worker.postMessage({type:"resetConsole"})}requestShowList(t){this.worker.postMessage({type:"showList",list:t})}requestRun(){this.worker.postMessage({type:"run"})}requestStop(){this.worker.postMessage({type:"stop"})}deleteFile(t,e){var s=this.sys,i=this.devicePath(e.device,e.path);try{s.log("BSYS:","delete",e.path),s.m.qfs.deleteFile(i,{clazz:this,method:"deletedFile",path:e.path,processId:e.processId})}catch(t){console.log(t),this.worker.postMessage({type:"message",processId:e.processId,message:"delete:error",messageObject:{reason:t.message}})}}deletedFile(t){this.sys.log("BSYS:","Deleted",t.args.qpath);var e="ok",s="delete:completed";t.result||(e="error",s="delete:error"),this.worker.postMessage({type:"message",processId:t.origCallBackRecord.processId,message:s,messageObject:{status:e,reason:void 0}})}saveProgram(t,e){var s=this.sys,i=this.devicePath(e.device,e.path);try{s.log("BSYS:","Load",e.path),s.m.qfs.saveFile(i,e.data,{clazz:this,method:"savedProgram",processId:e.processId})}catch(t){console.log(t),this.worker.postMessage({type:"message",processId:e.processId,message:"save:error",messageObject:{reason:t.message}})}}savedProgram(t){this.sys.log("BSYS:","Saved",t.url);var e="ok";t.result||(e="error"),this.worker.postMessage({type:"message",processId:t.origCallBackRecord.processId,message:"save:completed",messageObject:{status:e}})}loadDataFromProgram(t,e){var s=this.sys;try{s.log("BSYS:","Load",e.path),s.m.qfs.loadFile(e.path,{clazz:this,method:"loadedDataFromProgram",processId:e.processId,label:e.label,type:e.type})}catch(t){console.log(t),this.worker.postMessage({type:"message",processId:e.processId,message:"loaddata:error",messageObject:{error:t.message}})}}devicePath(t,e){var s=this.sys;if(t>-1){var i=s.m.qfs.getFS(t);if(!i)throw"No such device";if(e.split("://").length>1)throw"Double device indicators";return i.prefix+e}return e}loadAppFromProgram(t,e){var s=this.sys,i=this.devicePath(e.device,e.path);try{s.log("BSYS:","Load",e.path),s.m.qfs.loadFile(i,{clazz:this,method:"loadedAppFromProgram",processId:e.processId})}catch(t){console.log(t),this.worker.postMessage({type:"message",processId:e.processId,message:"load:error",messageObject:{reason:t.message}})}}loadedApp(t,e,s){this.sys.log("BSYS:","Loaded",e.url),this.out.blinkMode(!1),this.worker.postMessage({type:"loadpgm",pgmData:s.data,QPath:t})}loadedDataFromProgram(t,e,s){this.sys.log("BSYS:","Loaded",e.url),s.success?this.worker.postMessage({type:"message",processId:e.processId,message:"loaddata:completed",messageObject:{data:s.data,label:e.label,type:e.type}}):this.worker.postMessage({type:"message",processId:e.processId,message:"loaddata:error",messageObject:{pgmData:null,reason:s.reason}})}loadedAppFromProgram(t,e,s){this.sys.log("BSYS:","Loaded",e.url),s.success?this.worker.postMessage({type:"message",processId:e.processId,message:"load:completed",messageObject:{pgmData:s.data}}):this.worker.postMessage({type:"message",processId:e.processId,message:"load:error",messageObject:{pgmData:null,reason:s.reason}})}listfs(t){var e=this.sys.fs.listFS();this.worker.postMessage({type:"message",processId:t.processId,message:"listfs:completed",messageObject:{fs:e,currentFs:this.sys.fs.getCurrent()}})}setfs(t,e){var s=this.sys.fs.setFS(t);s=s?"ok":"error",this.worker.postMessage({type:"message",processId:e.processId,message:"setfs:completed",messageObject:{status:s}})}dir(t,e){try{var s=this.devicePath(e.device,t),i=this.sys.fs.getDir(s);this.worker.postMessage({type:"message",processId:e.processId,message:"dir:completed",messageObject:{files:i.files,title:i.title,free:i.free,fs:i.fs}})}catch(t){console.log(t),this.worker.postMessage({type:"message",processId:e.processId,message:"dir:error",messageObject:{reason:t.message}})}}setInput(t){this.sys.log("BSYS: Setting input on BAPPS.."),this.input=t,this.input.setInputHandler(this,"input")}inputKeyHandler(t){if(this.sys.m.basicmenu&&(this.sys.m.basicmenu.clearMenu(),"v"==t.key&&t.ctrlKey))return console.log(t),void this.sys.m.basicmenu.doAction("paste","txt");"Backspace"==t.keyLabel&&t.ctrlKey?this.worker.postMessage({type:"toggleMenu"}):this.worker.postMessage(t)}},l.i.basicmenu=class{constructor(t){this.sys=t,this.defaultPasteText="Press CTRL-V here",this.options=(new a).getOptions(),this.handlers=new o(this),this.menus={},this.statusWidgets={},this.status={pgmLen:0,status:"stopped",varLen:0,displayMode:0},this.mnuBttnOptContainers=[],this.mnuBttnOptContainersTgl=[],this.mnuBttns=[],this.mnuBttnContainers=[],this.mnuLinks=[],this.color="#ffffff",this.bgColor="#000000",this.font="16px arial,serif",this.statusTopMargin="4px",this.statusColor="#eeffff",this.statusBgColor="#000000",this.statusFont="700 14px arial,serif",this.cnt=0}destroy(){for(var t=this.getOnClickMenuButtonFunc(),e=0;e<this.mnuBttns.length;e++){var s=this.mnuBttns[e];s.dataset.i=e,this.mnuBttnOptContainers[e],t=this.getOnClickMenuButtonFunc(),s.removeEventListener("click",t);for(var i=this.mnuLinks[e],r=0;r<i.length;r++){var a=i[r];a.dataset.i=e,a.removeEventListener("click",this.getClickLinkFunc()),a.removeEventListener("mouseover",this.getOnOverLinkFunc())}}this.element=null}init(){this.handlers.setBasic(),this.basic=this.sys.m.basic}showMenu(t){this.element.style.display=t?"flex":"none"}button(t,e,s,i){var r=document.createElement("div"),a=document.createElement("button"),o=document.createElement("div");r.appendChild(a),r.appendChild(o),r.id="menu_buttnparent_"+e,a.innerHTML=s,a.id="menu_buttn_"+e,a.style.backgroundColor=this.bgColor,a.style.color=this.color,a.style.font=this.font,a.style.marginLeft="2px",a.style.marginRight="0px",a.style.borderTop="0px #ccc solid",a.style.borderBottom="0px #ccc solid",a.style.borderLeft="0px #777 solid",a.style.borderRight="0px #777 solid",o.id="menu_opts_buttn_"+e,o.style.display="none",o.style.marginLeft="2px",o.style.position="absolute",o.style.minWidth="260px",o.style.zIndex="1",o.style.backgroundColor=this.bgColor,o.style.color=this.color,o.style.borderTop="1px #ccc solid",o.style.borderBottom="1px #ccc solid",o.style.borderLeft="1px #777 solid",o.style.borderRight="1px #777 solid",this.mnuBttns.push(a),this.mnuBttnContainers.push(r),this.mnuBttnOptContainers.push(o),this.mnuBttnOptContainersTgl.push({active:!1});var n=[];if(i)for(var l=0;l<i.length;l++){var h=i[l],c=document.createElement("a");c.innerHTML=h.display,c.style.padding="12px 16px",c.style.display="block",c.style.font=this.font,c.dataset.action=h.opt,h.data&&(c.dataset.data=JSON.stringify(h.data)),n.push(c),o.appendChild(c)}this.mnuLinks.push(n),r.style.display="inline-block",r.style.position="relative",t.appendChild(r)}doAction(t,e){this.showMenu(!0),this.handlers.doExposedAction(t,e)}statusItem(t,e){var s=document.createElement("div");return s.innerText=e,""==e?s.style.width="10px":" "==e&&(s.style.width="50px"),s.style.marginTop=this.statusTopMargin,s.style.color=this.statusColor,s.style.backgroundColor=this.statusBgColor,s.style.font=this.statusFont,t.appendChild(s),this.statusWidgets.list.push(s),s}statusItems(t){this.statusWidgets.list=[],this.statusItem(t," "),this.statusWidgets.displayMode=this.statusItem(t,"MODE: "+this.status.displayMode),this.statusItem(t,""),this.statusWidgets.fs=this.statusItem(t,"FS: "+this.sys.fs.getCurrent()),this.statusItem(t,""),this.statusWidgets.pgmLen=this.statusItem(t,"LINES: "+this.status.pgmLen),this.statusItem(t,""),this.statusWidgets.varLen=this.statusItem(t,"VARCOUNT: "+this.status.varLen),this.statusItem(t,""),this.statusWidgets.interpreterStatus=this.statusItem(t,"STATUS: "+this.status.status)}setStatus(t){this.statusWidgets.fs.innerText="FS: "+this.sys.fs.getCurrent(),t&&(this.status=t,this.statusWidgets.interpreterStatus.innerText="STATUS: "+this.status.status,this.statusWidgets.pgmLen.innerText="LINES: "+this.status.pgmLen,this.statusWidgets.varLen.innerText="VARCOUNT: "+this.status.varLen,this.statusWidgets.displayMode.innerText="MODE: "+this.status.displayMode)}buttons(t){for(var e=this.options.main,s=0;s<e.length;s++){var i=e[s];this.button(t,s,i.display,this.options[i.opt])}}onDeselect(){"none"!=this.element.style.display&&this.clearMenu()}styleButtons(t){t.style.backgroundColor="black",t.style.color="white",t.style.width="100%"}create(){this.element=document.createElement("div"),this.element.style.marginLeft="auto",this.element.style.marginRight="auto",this.element.style.display="none",this.element.style.backgroundColor=this.statusBgColor,this.element.style.paddingBottom="5px",this.element.style.paddingTop="5px",this.buttons(this.element),this.statusItems(this.element);var t=document.createElement("div");this.pastebox=t,t.style.display="none",t.style.width="100%";var e=document.createElement("textarea");this.pasteArea=e,e.style.width="100%",e.style.height="200px",this.element.appendChild(t),t.appendChild(e)}get(){return this.element}getClickLinkFunc(){var t=this;return function(){console.log(this.dataset.action);for(var e=0;e<t.mnuBttnOptContainers.length;e++){var s=t.mnuBttnOptContainers[e],i=t.mnuBttnOptContainersTgl[e];console.log("dsp["+e+"]",s),s.style.display="none",i.active=!1}var r=void 0;"string"==(typeof this.dataset.data).toLowerCase()&&(r=JSON.parse(this.dataset.data)),this.dataset.action.startsWith("@")?t.basic[this.dataset.action.substr(1)](r):t.handlers["handler_"+this.dataset.action](r)}}getOnOverLinkFunc(){var t=this;return function(){for(var e=t.mnuLinks[this.dataset.i],s=0;s<e.length;s++){var i=e[s];i.style.color=t.color,i.style.backgroundColor=t.bgColor}this.style.color=t.bgColor,this.style.backgroundColor=t.color}}getOnClickMenuButtonFunc(){var t=this;return function(){for(var e=this.dataset.i,s=t.mnuBttnOptContainersTgl[e].active,i=0;i<t.mnuBttnOptContainers.length;i++){var r=t.mnuBttnOptContainers[i],a=t.mnuBttnOptContainersTgl[i];console.log("dsp["+i+"]",r),r.style.display="none",a.active=!1}for(i=0;i<t.mnuBttnOptContainers.length;i++)r=t.mnuBttnOptContainers[i],console.log("dsp["+i+"]",r.style.display);for(var o=t.mnuLinks[e],n=0;n<o.length;n++){var l=o[n];l.style.color=t.color,l.style.backgroundColor=t.bgColor}var h=t.mnuBttnOptContainers[e];console.log(s),s?(t.mnuBttnOptContainersTgl[e].active=!1,h.style.display="none"):(t.mnuBttnOptContainersTgl[e].active=!0,h.style.display="block")}}enable(){for(var t=0;t<this.mnuBttns.length;t++){var e=this.mnuBttns[t];e.dataset.i=t,this.mnuBttnOptContainers[t];var s=this.getOnClickMenuButtonFunc();e.addEventListener("click",s);for(var i=this.mnuLinks[t],r=0;r<i.length;r++){var a=i[r];a.dataset.i=t,a.addEventListener("click",this.getClickLinkFunc()),a.addEventListener("mouseover",this.getOnOverLinkFunc())}}}setDimensions(t,e){this.element.style.width=t+"px",this.element.style.textAlign="left"}clearMenu(){for(var t=0;t<this.mnuBttnOptContainers.length;t++){var e=this.mnuBttnOptContainersTgl[t];e.active&&(this.mnuBttnOptContainers[t].style.display="none",e.active=!1)}}hideMenu(){for(var t=0;t<this.mnuBttnContainers.length;t++)this.mnuBttnContainers[t].style.display="none";var e=this.statusWidgets.list;for(t=0;t<e.length;t++)e[t].style.display="none"}unhideMenu(){for(var t=0;t<this.mnuBttnContainers.length;t++)this.mnuBttnContainers[t].style.display="block";var e=this.statusWidgets.list;for(t=0;t<e.length;t++)e[t].style.display="block"}},l.i.sfs=class{constructor(t){if(!t)throw"sys expected";this.initialized=!1,this.sys=t,this.prefix=t.SIG+t.SUBSYS+"__",this.deviceId=6}init(){this.initialize()}initialize(){this.currentDisk="SYS",this.initialized=!0,this.privacy=this.sys.m.priv}ready(){return this.initialized}getEmptyDirStructure(t){return{files:[],title:"temporary session"}}getDir(t,e){if(!this.initialized)return getEmptyDirStructure(null);var s=this.prefix+""+this.currentDisk+"_dir",i=sessionStorage.getItem(s);if(!i)return{files:[],title:"temporary session"};var r=JSON.parse(i);if(!r)return{files:[],title:"temporary session"};var a=r.title;r.title=a,r.free=32-r.files.length;for(var o=-1;;){for(var n=0;n<r.files.length;n++)if(null==r.files[n]){o=n;break}if(!(o>-1))break;r.files.splice(o,1),o=-1}if("*"!=t&&""!=t){var l=[];for(n=0;n<r.files.length;n++)e(t,r.files[n].fname)&&l.push(r.files[n]);r.files=l,r.free=32-r.files.length}return r}setDir(t){if(0!=this.privacy.confirmLocalStorage()&&this.initialized){var e=this.prefix+""+this.currentDisk+"_dir";sessionStorage.setItem(e,JSON.stringify(t))}}existsFile(t){if(!this.initialized)return!1;for(var e=this.getDir("",null),s=-1,i=0;i<e.files.length;i++)if(e.files[i].fname==t){s=i;break}return s>-1}removeFromDir(t){if(this.initialized){for(var e=this.getDir("",null),s=-1,i=0;i<e.files.length;i++)if(e.files[i].fname==t){s=i;break}s>-1&&e.files.splice(i,1),this.setDir(e)}}updateDir(t,e,s){if(this.initialized){for(var i=this.getDir("",null),r=-1,a=0;a<i.files.length;a++)if(i.files[a].fname==t){r=a;break}r>-1?(i.files[a].size=e,i.files[a].type=s):i.files.push({fname:t,size:e,type:s}),this.setDir(i)}}saveFile(t,e,s,i){if(!this.initialized)return!1;if(0==this.privacy.confirmLocalStorage())return!1;var r=t;t.length>32&&(r=t.substr(0,32));var a=this.prefix+""+this.currentDisk+"_"+r,o=JSON.stringify({type:s,data:e});return sessionStorage.setItem(a,o),this.updateDir(r,i,s),!0}makeError(t,e){return{success:!1,reason:t,details:e,fsErrorSignature:!0}}loadFile(t,e){if(!this.initialized)throw makeError("Filesystem not initialized");var s,i=this.prefix+""+this.currentDisk+"_"+t,r=sessionStorage.getItem(i);if(!r)throw makeError("File not found");try{s=JSON.parse(r).data}catch(t){throw makeError("File corrupt",t)}e.clazz[e.method](t,e,s)}deleteFile(t){if(!this.existsFile(t))return"no such file";try{this.removeFromDir(t),this._removeFile(t)}catch(t){return"unexpected"}return"ok"}_removeFile(t){var e=this.prefix+""+this.currentDisk+"_"+t;sessionStorage.removeItem(e)}formatDisk(){for(var t=this.getDir("",null),e=0;e<t.files.length;e++){var s=t.files[e].fname;this._removeFile(s)}t.files=[],t.title="Empty",this.setDir()}getFullDisk(){if(!this.initialized){var t={dir:e=this.getDir("",null),content:[]};return JSON.stringify(t)}for(var e=this.getDir("",null),s=[],i=0;i<e.files.length;i++){var r=e.files[i].fname,a=this.prefix+""+this.currentDisk+"_"+r,o=sessionStorage.getItem(a);s.push({fname:r,content:o})}t={dir:e,content:s};var n=JSON.stringify(t);return console.log(n),n}},l.i.cache=class{constructor(t){if(!t)throw"sys expected";this.initialized=!1,this.sys=t,this.prefix=t.SIG+"_"+t.SUBSYS+"__",this.deviceId=5,console.log("FILESYSMODULE lfs: "+this.prefix)}makeDataContainer(t){return{success:!0,data:t}}init(){this.initialize()}initialize(){this.privacy=this.sys.m.priv,this.disks=[],this.currentDisk=null;var t=localStorage.getItem(this.prefix+"disks_list");if(null==t){var e="0001";this.disks=[e],this.currentDisk=e,this.lastDisk=1,this.disksNotInitialized=!0,1==this.privacy.confirmLocalStorage()&&(localStorage.setItem(this.prefix+"disks_list",JSON.stringify(this.disks)),localStorage.setItem(this.prefix+"0001_dir",JSON.stringify({files:[],title:"Default",readOnly:!1})),localStorage.setItem(this.prefix+"disk_current",e),this.formatDisk())}else{this.disks=JSON.parse(t),this.currentDisk=localStorage.getItem(this.prefix+"disk_current");for(var s=-1,i=0;i<this.disks.length;i++)parseInt(this.disks[i])>s&&(s=parseInt(this.disks[i]));this.lastDisk=s}this.initialized=!0}selectDisk(t){this.currentDisk=t,1==this.privacy.confirmLocalStorage()&&localStorage.setItem(this.prefix+"disk_current",t)}ready(){return this.initialized}getDisks(){if(!this.initialized)return[];var t=this.prefix+"disks_list",e=localStorage.getItem(t);return JSON.parse(e)}getEmptyDirStructure(t){return{files:[],title:"null"}}getDir(t,e){if(!this.initialized)return this.getEmptyDirStructure(null);var s=this.prefix+""+this.currentDisk+"_dir",i=localStorage.getItem(s),r=JSON.parse(i),a=r.title;if(!i)return{files:[],title:a};r.title=a,r.free=32-r.files.length;for(var o=-1;;){for(var n=0;n<r.files.length;n++)if(null==r.files[n]){o=n;break}if(!(o>-1))break;r.files.splice(o,1),o=-1}if("*"!=t&&""!=t){var l=[];for(n=0;n<r.files.length;n++)e(t,r.files[n].fname)&&l.push(r.files[n]);r.files=l,r.free=32-r.files.length}return r}setDir(t){if(this.initialized){var e=this.prefix+""+this.currentDisk+"_dir";1==this.privacy.confirmLocalStorage()&&localStorage.setItem(e,JSON.stringify(t))}}existsFile(t){if(!this.initialized)return!1;for(var e=this.getDir("",null),s=-1,i=0;i<e.files.length;i++)if(e.files[i].fname==t){s=i;break}return s>-1}removeFromDir(t){if(this.initialized){for(var e=this.getDir("",null),s=-1,i=0;i<e.files.length;i++)if(e.files[i].fname==t){s=i;break}s>-1&&e.files.splice(i,1),this.setDir(e)}}updateDir(t,e,s){if(this.initialized){for(var i=this.getDir("",null),r=-1,a=0;a<i.files.length;a++)if(i.files[a].fname==t){r=a;break}r>-1?(i.files[a].size=e,i.files[a].type=s):i.files.push({fname:t,size:e,type:s}),this.setDir(i)}}saveFile(t,e,s,i){if(this.initialized){var r=t;t.length>32&&(r=t.substr(0,32)),r.startsWith("$/")&&(r=r.substr(2));var a=this.prefix+""+this.currentDisk+"_"+r,o=JSON.stringify({type:s,data:e});return 1==this.privacy.confirmLocalStorage()&&(localStorage.setItem(a,o),this.updateDir(r,i,s),!0)}}makeError(t,e){return{success:!1,reason:t,details:e,fsErrorSignature:!0}}loadFile(t,e){var s=this.makeError;if(!this.initialized)throw s("Filesystem not initialized");var i=t;if("*"==i){var r=this.getDir("",null);r.files&&r.files.length>0&&r.files[0]&&(i=r.files[0].fname)}var a,o=this.prefix+""+this.currentDisk+"_"+i,n=localStorage.getItem(o);if(!n)throw s("File not found");try{a=JSON.parse(n).data}catch(t){throw s("File corrupt",t)}e.clazz[e.method](t,e,this.makeDataContainer(a))}deleteFile(t){if(!this.existsFile(t))throw"no such file";try{this.removeFromDir(t),this._removeFile(t)}catch(t){throw"unexpected ("+t.message+")"}return!0}_removeFile(t){var e=this.prefix+""+this.currentDisk+"_"+t;localStorage.removeItem(e)}formatDisk(){for(var t=this.getDir("",null),e=0;e<t.files.length;e++){var s=t.files[e].fname;this._removeFile(s)}t.files=[],t.title="Empty",this.setDir()}createDiskFromImage(t,e){this.createDiskFromImage2(t,e,!1)}createSysDiskFromImage(t){this.createDiskFromImage2("SYS",t,!0)}createDiskFromImage2(t,e,s){if(0!=this.privacy.confirmLocalStorage()){var i;s?i="1":(this.lastDisk++,i=""+this.lastDisk),i=i.padStart(4,"0");var r=e.dir,a=e.outtent,o=this.prefix+""+i+"_dir";localStorage.setItem(o,JSON.stringify(r));for(var n=0;n<a.length;n++){var l=a[n].fname;o=this.prefix+""+i+"_"+l,localStorage.setItem(o,a[n].outtent)}this.disks.push(i),localStorage.setItem(this.prefix+"disks_list",JSON.stringify(this.disks))}}createDisk(){if(0!=this.privacy.confirmLocalStorage()){this.getDisks(),this.lastDisk++;var t=""+this.lastDisk;t=t.padStart(4,"0");var e=this.getEmptyDirStructure("NEW DISK"),s=this.prefix+""+t+"_dir";localStorage.setItem(s,JSON.stringify(e)),this.disks.push(t),localStorage.setItem(this.prefix+"disks_list",JSON.stringify(this.disks))}}getFullDisk(){if(!this.initialized){var t={dir:e=this.getDir("",null),content:[]};return JSON.stringify(t)}for(var e=this.getDir("",null),s=[],i=0;i<e.files.length;i++){var r=e.files[i].fname,a=this.prefix+""+this.currentDisk+"_"+r,o=localStorage.getItem(a);s.push({fname:r,content:o})}t={dir:e,content:s};var n=JSON.stringify(t);return console.log(n),n}},l.i.ramfs=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.files=[],this.data={},this.deviceId=7}init(){}ready(){return!0}getDir(t,e){var s=this.files;if("*"!=t&&""!=t){for(var i=[],r=0;r<this.files.length;r++)e(t,this.files[r].fname)&&i.push(this.files[r]);s=i}return{title:"Ram Disk",files:s,free:0}}exists(t){for(var e=this.getDir("",null).files,s=-1,i=0;i<e.length;i++)if(e[i].fname==t){s=i;break}return s>-1}makeError(t,e){return{success:!1,reason:t,details:e,fsErrorSignature:!0}}saveFile(t,e,s,i){if(t.indexOf("/")>-1)throw{message:"saveFile: '"+t+"' - invalid path, RAMFS device only supports flatdir"};if(!this.exists(t)){var r={fname:t,type:s,size:i};this.data[t]={type:s,data:e},this.files.push(r)}}makeDataContainer(t){return{success:!0,data:t}}loadFile(t,e){if(!this.exists(t))throw makeError("File not found");var s=this.makeDataContainer(this.data[t].data);e.clazz[e.method](t,e,s)}deleteFile(t){if(!this.exists(t))return!1;try{for(var e=this.files,s=[],i=0;i<e.length;i++)e[i].fname!=t&&s.push(e[i]);this.data[t]=void 0,this.files=s}catch(e){throw{message:"deleteFile: '"+t+"' - "+e.message}}return!0}formatDisk(){this.files=[],this.data={}}},l.i.script=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.files=[],this.data={},this.deviceId=1}init(){}ready(){return!0}exists(t){if(document.getElementById(t))return!0}saveFile(t,e,s,i){throw{message:"saveFile '"+t+"' - SCRIPTURL is readonly"}}makeDataContainer(t){return{success:!0,data:t}}loadTextFromURL(t,e){var s=new XMLHttpRequest,i=this;s.onreadystatechange=function(){4===s.readyState&&200===s.status&&i.loadedFile(t,e,i.makeDataContainer(s.responseText))},s.overrideMimeType("text/plain"),s.open("GET",t,!0),s.send(null)}makeError(t,e){return{success:!1,reason:t,details:e,fsErrorSignature:!0}}loadFile(t,e){if(!this.exists(t))throw makeError("File not found");var s=document.getElementById(t);if(""==s.innerText.trim()){var i=!1;if(s.src&&""!=s.src&&(i=!0),!i)return{type:"bas",data:'10 print "?program not found error"'};this.loadTextFromURL(s.src,e)}else{for(var r=s.innerText.split("\n"),a="",o=0;o<r.length;o++)""!=a&&(a+="\n"),a+=r[o].trim();e.clazz[e.method](t,e,this.makeDataContainer(a))}}loadedFile(t,e,s){e.clazz[e.method](t,e,s)}getDir(t,e){for(var s=document.getElementsByTagName("script"),i=[],r=0;r<s.length;r++){var a=s.item(r);console.log(a.attributes.id);var o=a.attributes.id.nodeValue;i.push({fname:o})}if("*"!=t&&""!=t){var n=[];for(r=0;r<i.length;r++)e(t,i[r].fname)&&n.push(i[r]);i=n}return{files:i,title:"page scripts",free:0}}deleteFile(t){throw{message:"SCRIPTURL is readonly"}}formatDisk(){throw{message:"formatDisk '"+fileName+"' - SCRIPTURL is readonly"}}},l.i.site=class{constructor(t){if(!t)throw"sys expected";this.lib=new r(t),this.deviceId=2}init(){}ready(){return!0}exists(t){return this.lib.exists(t)}saveFile(t,e,s,i){this.lib.saveFile(t,e,s,i)}loadFile(t,e){this.lib.loadFile(t,e)}getDir(){return this.lib.getDir()}deleteFile(t){this.lib.deleteFile(t)}formatDisk(){this.lib.formatDisk()}},l.i.export=class{constructor(t){if(!t)throw"sys expected";this.sys=t,this.domCtr=this.sys.domContainer,this.deviceId=10}init(){this.link=document.createElement("a"),this.link.style.display="none",this.domCtr.appendChild(this.link)}makeError(t,e){return{success:!1,reason:t,message:e,fsErrorSignature:!0}}ready(){return!0}getDir(){throw this.makeError("getDir","Not Supported")}exists(t){return!1}saveFile(t,e,s,i){if(t.indexOf("/")>-1)throw{message:"saveFile: '"+t+"' - invalid path, TRANSFERFS device only supports flatdir"};const r=new Blob([e]),a=URL.createObjectURL(r);this.link.download=t,this.link.href=a,this.link.click()}loadFile(t){return null}deleteFile(t){return!1}formatDisk(){}},l.i.qfs=class{constructor(t,e){if(!t)throw"sys expected";if(!e)throw"dependencies expected";this.dependencies=e,this.initialized=!1,this.sys=t,this.defaultFS=t.bootCfg.fs.default,this.currentFS=this.defaultFS,this.validCharacters="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+-._"}init(){this.initialize()}initialize(){this.fsList=[];for(var t=this.dependencies,e=0;e<t.length;e++){var s=t[e],i={token:s,fs:this.sys.m[s],prefix:s+"://",device:this.sys.m[s].deviceId};this.fsList.push(i)}this.initialized=!0}matcher(t,e){if(t.endsWith("*")){var s=t.substr(0,t.length-1);if(e.startsWith(s))return!0}else if(t.startsWith("*")&&(s=t.substr(1),e.endsWith(s)))return!0;return!1}getCurrent(){return this.currentFS}getFSByDevId(t){for(var e=this.fsList,s=0;s<e.length;s++){var i=e[s];if(i.device==t)return i}return null}checkFS(t){if("number"==(typeof t).toLowerCase())return this.getFSByDevId(t);var e=t,s=this.fsList;1==e.split("://").length&&(e=t+"://");for(var i=0;i<s.length;i++){var r=s[i];if(e.startsWith(r.prefix))return r}return null}setFS(t){var e;return!!(e=this.checkFS(t))&&(this.currentFS=e.token,!0)}listFS(){for(var t=[],e=this.fsList,s=0;s<e.length;s++){var i=e[s];t.push({name:i.prefix,device:i.device})}return t.sort(((t,e)=>t.device>e.device?1:-1)),t}ready(){return this.initialized}getFS(t){if("number"==(typeof t).toLowerCase())return this.getFSByDevId(t);var e=this.fsList;if(1==t.split("://").length)for(var s=0;s<e.length;s++){var i=e[s];if(this.currentFS+"://"==i.prefix)return i}for(s=0;s<e.length;s++)if(i=e[s],t.startsWith(i.prefix))return i;return null}getLPath(t){if("number"==(typeof t).toLowerCase())return"";var e=t.split("://");return e.length<2?t:e[1]}getDir(t){if(!this.initialized)return{files:[],title:"null",free:-1,fs:"?"};var e=this.getFS(t);if(!e)return{files:[],title:"null",free:-1,fs:"?"};var s=e.fs.getDir(this.getLPath(t),this.matcher);return s.fs=e.prefix,s}existsFile(t){return this.initialized,!1}checkFileName(t){for(var e=0;e<t.length;e++){var s=t.charAt(e);if(this.validCharacters.indexOf(s)<0)return!1}return!0}doCallBack(t,e){t.clazz?(t.data&&(e.cbData=t.data),t.clazz[t.method](e)):t(e)}saveFile(t,e,s,i,r){if(!this.initialized)return null;var a=t.toLowerCase(),o=this.getFS(a);if(!o)throw{message:a+" has unknown file system"};var n=this.getLPath(a);if(!n)throw{message:"QPath '"+a+"' has no local path"};if(!this.checkFileName(n))throw{message:"path '"+n+"' has invalid characters"};var l=o.fs.saveFile(n,e,i,r),h={};h.qpath=a,h.type=i,h.length=r;var c={result:l,args:h,origCallBackRecord:s};return this.doCallBack(s,c),null}makeError(t,e){return{success:!1,reason:t,details:e,fsErrorSignature:!0}}loadFile(t,e){var s=t.toLowerCase(),i=e,r=this.makeError;if(this.initialized){var a=this.getFS(s);if(a){var o=this.getLPath(s);if(o){if(!this.checkFileName(o))throw{message:"path '"+o+"' has invalid characters"};var n={origCallBackRecord:e,qpath:s,clazz:this,method:"loadedFile"};try{a.fs.loadFile(o,n)}catch(t){return t.fsErrorSignature?void i.clazz[i.method](s,i,r(t.reason)):void i.clazz[i.method](s,i,r("Internal error",t))}}else i.clazz[i.method](s,i,r("QPath '"+s+"' has no local path"))}else i.clazz[i.method](s,i,r(s+" has unknown file system"))}else i.clazz[i.method](s,i,r("Not Initialized"))}loadedFile(t,e,s){var i=e.origCallBackRecord;i.clazz[i.method](e.qpath,i,s)}deleteFile(t,e){if(!this.initialized)return null;var s=t.toLowerCase(),i=this.getFS(s);if(!i)throw{message:s+" has unknown file system"};var r=this.getLPath(s);if(!r)throw{message:"QPath '"+s+"' has no local path"};if(!this.checkFileName(r))throw{message:"path '"+r+"' has invalid characters"};var a=i.fs.deleteFile(r),o={};o.qpath=s;var n={result:a,args:o,origCallBackRecord:e};return this.doCallBack(e,n),null}formatDisk(t){return this.existsFile(fileName)?"error":"no such file"}},l.dep.basicmenu=["domelinput"],l.dep.qfs=["ramfs","cache","sfs","script","site","export"],l.dep.basic=["canvas","tablecon","displaymodes","mrbeepaudio","qfs","htmlwrapper","basicmenu"],l.initSimpleLogging();for(var d=Object.getOwnPropertyNames(l.i),u=[],g=0;g<d.length;g++){var p=d[g];void 0!==d[g]&&c(p,u,0)}for(g=0;g<u.length;g++)console.log("construct "+u[g]),l.m[u[g]]=new l.i[u[g]](h,l.dep[u[g]]);for(h.audio=h.m.mrbeepaudio,h.init.queuedMessages=h.nulcon,h.init.conStyle=l.conStyle,h.init.displayMode=l.displayMode,h.m=l.m,h.fs=l.m.qfs,h.input=l.m.domelinput,h.m.displaymodes.setMode(l.displayMode,h.m.basicmenu),l.out=h.out,g=0;g<u.length;g++)console.log("init "+u[g]),l.m[u[g]].init();try{var f=l.rootScript.dataset.script;null==f&&(f="autorun.bas"),l.onReady="script://"+f}catch(t){throw alert("HALT: Boot-Onready Handler not found!!"),"HALT - Neither root-script-attribute 'basScript' or constant 'BOOT_ONREADY' defined."}h.nulcon=void 0,l.input=l.m.domelinput,console.log("boot.basic=",l.basic),l.m.basic.setInput(l.input),l.m.basic.loadApp(l.onReady)})();
//# sourceMappingURL=basicloader.js.map